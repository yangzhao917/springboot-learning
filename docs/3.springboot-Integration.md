# SpringBootæ•´åˆ

## ğŸ“š ç›®å½•

- [å†…å®¹æ¦‚è§ˆ](#å†…å®¹æ¦‚è§ˆ)
- [3.1 SpringBootæ•´åˆJUnit](#31-ä»€ä¹ˆæ˜¯springbootæ•´åˆjunit)
- [3.2 ä¾èµ–é…ç½®](#32-ä¾èµ–é…ç½®)
- [3.3 æ ¸å¿ƒæ³¨è§£è¯´æ˜](#33-æ ¸å¿ƒæ³¨è§£è¯´æ˜)
- [3.4 åŸºç¡€æµ‹è¯•ç¤ºä¾‹](#34-åŸºç¡€æµ‹è¯•ç¤ºä¾‹)
- [3.5 å¸¸ç”¨æµ‹è¯•åœºæ™¯](#35-å¸¸ç”¨æµ‹è¯•åœºæ™¯)
- [3.6 æµ‹è¯•æœ€ä½³å®è·µ](#36-æµ‹è¯•æœ€ä½³å®è·µ)
- [3.7 SpringBootæ•´åˆRedis](#37-springbootæ•´åˆredis)
- [3.8 æ€»ç»“](#38-æ€»ç»“)

---

## å†…å®¹æ¦‚è§ˆ

æœ¬æ–‡æ¡£å…¨é¢ä»‹ç»Spring Bootæ•´åˆå¸¸ç”¨æŠ€æœ¯æ¡†æ¶ï¼Œæ¶µç›–ä»¥ä¸‹æ ¸å¿ƒå†…å®¹ï¼š

### ğŸ“š ä¸»è¦å†…å®¹

#### ç¬¬ä¸€éƒ¨åˆ†ï¼šSpringBootæ•´åˆJUnit
- **æµ‹è¯•æ¡†æ¶æ•´åˆ**ï¼šä½¿ç”¨JUnitè¿›è¡Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- **æ ¸å¿ƒæ³¨è§£**ï¼š`@SpringBootTest`ã€`@RunWith`ã€`@Test`ç­‰æ³¨è§£è¯¦è§£
- **æµ‹è¯•åœºæ™¯**ï¼šServiceå±‚ã€Controllerå±‚ã€é…ç½®æ–‡ä»¶ç­‰å¤šç§æµ‹è¯•åœºæ™¯
- **æœ€ä½³å®è·µ**ï¼šæµ‹è¯•å‘½åè§„èŒƒã€æµ‹è¯•éš”ç¦»ã€æ–­è¨€ä½¿ç”¨ç­‰

#### ç¬¬äºŒéƒ¨åˆ†ï¼šSpringBootæ•´åˆRedis
- **ç¼“å­˜æ¡†æ¶æ•´åˆ**ï¼šå¿«é€Ÿé›†æˆRediså†…å­˜æ•°æ®åº“
- **æ ¸å¿ƒç»„ä»¶**ï¼š`RedisTemplate`ä½¿ç”¨å’Œåºåˆ—åŒ–é…ç½®
- **å¸¸ç”¨æ“ä½œ**ï¼šStringã€Hashã€Listã€Setç­‰æ•°æ®ç±»å‹æ“ä½œ
- **å®è·µæŒ‡å—**ï¼šåºåˆ—åŒ–é…ç½®ã€è¿‡æœŸæ—¶é—´è®¾ç½®ã€é”®å‘½åè§„èŒƒç­‰

### ğŸ”§ æ ¸å¿ƒä¾èµ–
- **spring-boot-starter-test**ï¼šæµ‹è¯•èµ·æ­¥ä¾èµ–ï¼ŒåŒ…å«JUnitã€Mockitoã€AssertJç­‰
- **spring-boot-starter-data-redis**ï¼šRedisèµ·æ­¥ä¾èµ–ï¼Œè‡ªåŠ¨é…ç½®Redisè¿æ¥

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§
- **è‡ªåŠ¨åŒ–é…ç½®**ï¼šSpring Bootè‡ªåŠ¨é…ç½®æµ‹è¯•ç¯å¢ƒå’ŒRedisè¿æ¥
- **ä¾èµ–æ³¨å…¥**ï¼šæ”¯æŒåœ¨æµ‹è¯•å’ŒæœåŠ¡ç±»ä¸­ä½¿ç”¨`@Autowired`æˆ–`@Resource`
- **ç®€åŒ–å¼€å‘**ï¼šæä¾›ä¸°å¯Œçš„æ³¨è§£å’Œå·¥å…·ç±»ï¼Œå‡å°‘ä»£ç ç¼–å†™é‡

### ğŸ“ é€‚ç”¨åœºæ™¯
- **å•å…ƒæµ‹è¯•**ï¼šæµ‹è¯•å•ä¸ªç»„ä»¶æˆ–æ–¹æ³•çš„åŠŸèƒ½
- **é›†æˆæµ‹è¯•**ï¼šæµ‹è¯•å¤šä¸ªç»„ä»¶ååŒå·¥ä½œçš„æƒ…å†µ
- **ç¼“å­˜ä½¿ç”¨**ï¼šçƒ­ç‚¹æ•°æ®ç¼“å­˜ã€ä¼šè¯å­˜å‚¨ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé€šè¿‡ç¼“å­˜æå‡åº”ç”¨æ€§èƒ½å’Œå“åº”é€Ÿåº¦

---

## 3.1 ä»€ä¹ˆæ˜¯SpringBootæ•´åˆJUnit

SpringBootæ•´åˆJUnitæ˜¯æŒ‡åœ¨Spring Bootåº”ç”¨ä¸­ï¼Œä½¿ç”¨JUnitæµ‹è¯•æ¡†æ¶æ¥ç¼–å†™å’Œè¿è¡Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ã€‚

### ğŸ¯ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨SpringBootæ•´åˆJUnitï¼Ÿ

1. **è‡ªåŠ¨åŒ–é…ç½®** ğŸš€
   - Spring Bootè‡ªåŠ¨é…ç½®æµ‹è¯•ç¯å¢ƒ
   - ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºSpringåº”ç”¨ä¸Šä¸‹æ–‡
   - è‡ªåŠ¨åŠ è½½æµ‹è¯•é…ç½®

2. **ä¾èµ–æ³¨å…¥** ğŸ’‰
   - å¯ä»¥åœ¨æµ‹è¯•ä¸­ç›´æ¥ä½¿ç”¨`@Autowired`æˆ–`@Resource`æ³¨å…¥Bean
   - æµ‹è¯•ä»£ç å¯ä»¥åƒæ­£å¸¸ä»£ç ä¸€æ ·ä½¿ç”¨Springçš„åŠŸèƒ½

3. **ç®€åŒ–æµ‹è¯•** âœ¨
   - æä¾›æµ‹è¯•ä¸“ç”¨çš„æ³¨è§£å’Œå·¥å…·ç±»
   - å‡å°‘æµ‹è¯•ä»£ç çš„ç¼–å†™é‡
   - æé«˜æµ‹è¯•æ•ˆç‡

4. **å®Œæ•´çš„æµ‹è¯•ç”Ÿæ€** ğŸ› ï¸
   - é›†æˆäº†Mockitoç”¨äºæ¨¡æ‹Ÿå¯¹è±¡
   - é›†æˆäº†AssertJç”¨äºæ–­è¨€
   - é›†æˆäº†Hamcrestç”¨äºåŒ¹é…å™¨

### ğŸ¤” Spring Bootæµ‹è¯• vs æ™®é€šJUnitæµ‹è¯•

| ç‰¹æ€§ | æ™®é€šJUnitæµ‹è¯• | Spring Bootæµ‹è¯• |
|------|--------------|----------------|
| Springå®¹å™¨ | âŒ ä¸åŠ è½½ | âœ… è‡ªåŠ¨åŠ è½½ |
| ä¾èµ–æ³¨å…¥ | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| é…ç½®åŠ è½½ | âŒ ä¸åŠ è½½ | âœ… åŠ è½½application.properties |
| è‡ªåŠ¨é…ç½® | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| æµ‹è¯•å¤æ‚åº¦ | ğŸŸ¢ ç®€å• | ğŸŸ¡ ä¸­ç­‰ |
| é€‚ç”¨åœºæ™¯ | çº¯é€»è¾‘æµ‹è¯• | é›†æˆæµ‹è¯•ã€SpringåŠŸèƒ½æµ‹è¯• |

---

## 3.2 JUnitä¾èµ–é…ç½®

Spring Bootæä¾›äº†`spring-boot-starter-test`èµ·æ­¥ä¾èµ–ï¼Œå®ƒä¼šè‡ªåŠ¨å¼•å…¥æ‰€éœ€çš„æµ‹è¯•æ¡†æ¶ã€‚

### ğŸ“¦ Mavenä¾èµ–é…ç½®

åœ¨`pom.xml`ä¸­å·²ç»åŒ…å«äº†æµ‹è¯•ä¾èµ–ï¼š

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-test</artifactId>
    <scope>test</scope>
</dependency>
```

### ğŸ“‹ spring-boot-starter-teståŒ…å«çš„å†…å®¹

è¿™ä¸ªä¾èµ–è‡ªåŠ¨åŒ…å«äº†ä»¥ä¸‹æµ‹è¯•æ¡†æ¶ï¼š

| æ¡†æ¶ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| JUnit | 4.12 | Javaå•å…ƒæµ‹è¯•æ¡†æ¶ |
| Spring Test | - | Springæµ‹è¯•æ”¯æŒ |
| AssertJ | 3.x | æµç•…çš„æ–­è¨€åº“ |
| Hamcrest | 1.3 | åŒ¹é…å™¨åº“ |
| Mockito | 2.x | Mockæ¡†æ¶ |
| JSONassert | - | JSONæ–­è¨€ |
| JsonPath | - | JSONè·¯å¾„æŸ¥è¯¢ |

> **æ³¨æ„**ï¼š`<scope>test</scope>`è¡¨ç¤ºè¿™äº›ä¾èµ–åªåœ¨æµ‹è¯•æ—¶ä½¿ç”¨ï¼Œä¸ä¼šæ‰“åŒ…åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚

---

## 3.3 æ ¸å¿ƒæ³¨è§£è¯´æ˜

Spring Bootæµ‹è¯•æä¾›äº†ä¸°å¯Œçš„æ³¨è§£æ¥ç®€åŒ–æµ‹è¯•ä»£ç çš„ç¼–å†™ã€‚

### ğŸ¯ å¿…é¡»ä½¿ç”¨çš„æ³¨è§£

#### @SpringBootTest

**ä½œç”¨**ï¼šåŠ è½½å®Œæ•´çš„Springåº”ç”¨ä¸Šä¸‹æ–‡ï¼Œç”¨äºé›†æˆæµ‹è¯•ã€‚

**å±æ€§è¯´æ˜**ï¼š
- `classes`ï¼šå¿…å¡«ï¼ˆå¦‚æœä¸é…ç½®ï¼Œéœ€è¦ç¡®ä¿ç±»è·¯å¾„ä¸­æœ‰å”¯ä¸€çš„å¯åŠ¨ç±»ï¼‰
  - æŒ‡å®šSpring Bootçš„å¯åŠ¨ç±»
  - ä¾‹å¦‚ï¼š`@SpringBootTest(classes = App.class)`

**ä½¿ç”¨åœºæ™¯**ï¼š
- éœ€è¦æµ‹è¯•Spring Beanä¹‹é—´çš„äº¤äº’
- éœ€è¦åŠ è½½å®Œæ•´çš„åº”ç”¨é…ç½®
- éœ€è¦æµ‹è¯•æ•°æ®åº“æ“ä½œç­‰é›†æˆåŠŸèƒ½

```java
@SpringBootTest(classes = App.class)
public class UserServiceImplTest {
    // æµ‹è¯•ä»£ç 
}
```

#### @RunWith(SpringRunner.class)

**ä½œç”¨**ï¼šæŒ‡å®šä½¿ç”¨Springçš„æµ‹è¯•è¿è¡Œå™¨æ¥è¿è¡Œæµ‹è¯•ã€‚

**è¯´æ˜**ï¼š
- `SpringRunner`æ˜¯Springæä¾›çš„JUnit 4æµ‹è¯•è¿è¡Œå™¨
- å¦‚æœæ²¡æœ‰è¿™ä¸ªæ³¨è§£ï¼ŒSpringçš„æµ‹è¯•åŠŸèƒ½ï¼ˆå¦‚ä¾èµ–æ³¨å…¥ï¼‰ä¸ä¼šç”Ÿæ•ˆ
- JUnit 5ä¸­ä½¿ç”¨`@ExtendWith(SpringExtension.class)`æ›¿ä»£

```java
@RunWith(SpringRunner.class)
@SpringBootTest(classes = App.class)
public class UserServiceImplTest {
    // æµ‹è¯•ä»£ç 
}
```

#### @Test

**ä½œç”¨**ï¼šæ ‡è®°ä¸€ä¸ªæ–¹æ³•ä¸ºæµ‹è¯•æ–¹æ³•ï¼ŒJUnitä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ã€‚

```java
@Test
public void testDoAdd() {
    // æµ‹è¯•é€»è¾‘
}
```

### ğŸ”§ å¯é€‰æ³¨è§£

#### @Before

**ä½œç”¨**ï¼šåœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œå‰è¿è¡Œï¼Œç”¨äºæµ‹è¯•å‰ç½®å‡†å¤‡ã€‚

```java
@Before
public void setUp() throws Exception {
    // åˆå§‹åŒ–æµ‹è¯•æ•°æ®
    // å‡†å¤‡æµ‹è¯•ç¯å¢ƒ
}
```

#### @After

**ä½œç”¨**ï¼šåœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œåè¿è¡Œï¼Œç”¨äºæµ‹è¯•åç½®æ¸…ç†ã€‚

```java
@After
public void tearDown() throws Exception {
    // æ¸…ç†æµ‹è¯•æ•°æ®
    // é‡Šæ”¾èµ„æº
}
```

#### @Autowired / @Resource

**ä½œç”¨**ï¼šåœ¨æµ‹è¯•ç±»ä¸­æ³¨å…¥Springç®¡ç†çš„Beanã€‚

- `@Autowired`ï¼šSpringçš„æ³¨è§£ï¼ŒæŒ‰ç±»å‹æ³¨å…¥
- `@Resource`ï¼šJSR-250æ ‡å‡†æ³¨è§£ï¼ŒæŒ‰åç§°æˆ–ç±»å‹æ³¨å…¥

```java
@Resource
private UserServiceImpl userService;

// æˆ–è€…
@Autowired
private UserServiceImpl userService;
```

---

## 3.4 åŸºç¡€æµ‹è¯•ç¤ºä¾‹

è®©æˆ‘ä»¬é€šè¿‡å®é™…ç¤ºä¾‹æ¥å­¦ä¹ å¦‚ä½•ç¼–å†™Spring Bootæµ‹è¯•ã€‚

### ğŸ“ ç¤ºä¾‹ï¼šServiceå±‚æµ‹è¯•

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª`UserServiceImpl`æœåŠ¡ç±»ï¼š

```java
@Service
public class UserServiceImpl {
    public void doAdd(){
        System.out.println("doAdd >>>> " + System.currentTimeMillis());
    }
}
```

å¯¹åº”çš„æµ‹è¯•ç±»`UserServiceImplTest`ï¼š

```java
package org.example.service;

import org.example.App;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import javax.annotation.Resource;

@RunWith(SpringRunner.class)
@SpringBootTest(classes = App.class)
public class UserServiceImplTest {

    @Resource
    private UserServiceImpl userService;

    @Before
    public void setUp() throws Exception {
        System.out.println("æµ‹è¯•å¼€å§‹å‰çš„å‡†å¤‡å·¥ä½œ");
    }

    @After
    public void tearDown() throws Exception {
        System.out.println("æµ‹è¯•ç»“æŸåçš„æ¸…ç†å·¥ä½œ");
    }

    @Test
    public void testDoAdd() {
        // æ‰§è¡Œè¢«æµ‹è¯•çš„æ–¹æ³•
        userService.doAdd();
        
        // å¦‚æœæ²¡æœ‰å¼‚å¸¸ï¼Œè¯´æ˜æµ‹è¯•é€šè¿‡
        // ä¹Ÿå¯ä»¥æ·»åŠ æ–­è¨€æ¥éªŒè¯ç»“æœ
    }
}
```

### ğŸ” ä»£ç è§£æ

1. **@RunWith(SpringRunner.class)**
   - å‘Šè¯‰JUnitä½¿ç”¨Springçš„æµ‹è¯•è¿è¡Œå™¨
   - å¯ç”¨Springçš„æµ‹è¯•åŠŸèƒ½

2. **@SpringBootTest(classes = App.class)**
   - åŠ è½½Spring Bootåº”ç”¨ä¸Šä¸‹æ–‡
   - `classes = App.class`æŒ‡å®šå¯åŠ¨ç±»

3. **@Resource**
   - æ³¨å…¥`UserServiceImpl`å®ä¾‹
   - Springä¼šè‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†è¿™ä¸ªBean

4. **@Test**
   - æ ‡è®°`testDoAdd()`ä¸ºæµ‹è¯•æ–¹æ³•
   - JUnitä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•

5. **@Before / @After**
   - åœ¨æµ‹è¯•å‰åæ‰§è¡Œé€šç”¨é€»è¾‘
   - ç”¨äºå‡†å¤‡å’Œæ¸…ç†æµ‹è¯•ç¯å¢ƒ

### â–¶ï¸ è¿è¡Œæµ‹è¯•

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨IDEè¿è¡Œ

1. å³é”®ç‚¹å‡»æµ‹è¯•ç±»æˆ–æµ‹è¯•æ–¹æ³•
2. é€‰æ‹©"Run"æˆ–"Debug"
3. æŸ¥çœ‹æµ‹è¯•ç»“æœ

#### æ–¹å¼äºŒï¼šä½¿ç”¨Mavenå‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test

# è¿è¡ŒæŒ‡å®šæµ‹è¯•ç±»
mvn test -Dtest=UserServiceImplTest

# è¿è¡ŒæŒ‡å®šæµ‹è¯•æ–¹æ³•
mvn test -Dtest=UserServiceImplTest#testDoAdd
```

---

## 3.5 å¸¸ç”¨æµ‹è¯•åœºæ™¯

### ğŸ¯ åœºæ™¯1ï¼šæµ‹è¯•Serviceå±‚ä¸šåŠ¡é€»è¾‘

æµ‹è¯•ä¸šåŠ¡æ–¹æ³•æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œï¼ŒéªŒè¯è¿”å›å€¼å’Œå‰¯ä½œç”¨ã€‚

```java
@RunWith(SpringRunner.class)
@SpringBootTest(classes = App.class)
public class UserServiceTest {
    
    @Resource
    private UserService userService;
    
    @Test
    public void testAddUser() {
        // Given: å‡†å¤‡æµ‹è¯•æ•°æ®
        String username = "testUser";
        
        // When: æ‰§è¡Œè¢«æµ‹è¯•çš„æ–¹æ³•
        boolean result = userService.addUser(username);
        
        // Then: éªŒè¯ç»“æœ
        assertTrue("ç”¨æˆ·æ·»åŠ åº”è¯¥æˆåŠŸ", result);
    }
    
    @Test
    public void testGetUserById() {
        // Given
        Long userId = 1L;
        
        // When
        User user = userService.getUserById(userId);
        
        // Then
        assertNotNull("ç”¨æˆ·ä¸åº”è¯¥ä¸ºnull", user);
        assertEquals("ç”¨æˆ·IDåº”è¯¥åŒ¹é…", userId, user.getId());
    }
}
```

### ğŸ¯ åœºæ™¯2ï¼šæµ‹è¯•Controllerå±‚æ¥å£

æµ‹è¯•HTTPæ¥å£çš„è¯·æ±‚å’Œå“åº”ã€‚

```java
@RunWith(SpringRunner.class)
@SpringBootTest(classes = App.class)
@AutoConfigureMockMvc
public class UserControllerTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @Test
    public void testGetUser() throws Exception {
        mockMvc.perform(get("/user/1"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.id").value(1));
    }
    
    @Test
    public void testCreateUser() throws Exception {
        mockMvc.perform(post("/user")
                .contentType(MediaType.APPLICATION_JSON)
                .content("{\"username\":\"test\"}"))
                .andExpect(status().isCreated());
    }
}
```

### ğŸ¯ åœºæ™¯3ï¼šæµ‹è¯•é…ç½®æ–‡ä»¶åŠ è½½

éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®åŠ è½½ã€‚

```java
@RunWith(SpringRunner.class)
@SpringBootTest(classes = App.class)
public class ConfigTest {
    
    @Value("${spring.application.name}")
    private String appName;
    
    @Test
    public void testConfigLoad() {
        assertNotNull("åº”ç”¨åç§°åº”è¯¥è¢«åŠ è½½", appName);
        System.out.println("åº”ç”¨åç§°: " + appName);
    }
}
```

### ğŸ¯ åœºæ™¯4ï¼šæµ‹è¯•æ•°æ®è®¿é—®ï¼ˆéœ€è¦æ•°æ®åº“ï¼‰

æµ‹è¯•Repositoryæˆ–DAOå±‚çš„æ•°æ®åº“æ“ä½œã€‚

```java
@RunWith(SpringRunner.class)
@SpringBootTest(classes = App.class)
@Transactional  // æµ‹è¯•ç»“æŸåå›æ»šäº‹åŠ¡
public class UserRepositoryTest {
    
    @Autowired
    private UserRepository userRepository;
    
    @Test
    public void testSaveAndFind() {
        // Given
        User user = new User();
        user.setUsername("test");
        
        // When
        User saved = userRepository.save(user);
        User found = userRepository.findById(saved.getId()).orElse(null);
        
        // Then
        assertNotNull(found);
        assertEquals("test", found.getUsername());
    }
}
```

---

## 3.6 æµ‹è¯•æœ€ä½³å®è·µ

### âœ… 1. æµ‹è¯•å‘½åè§„èŒƒ

**å¥½çš„å‘½å**ï¼š
- `testAddUser()` - æ¸…æ¥šè¯´æ˜æµ‹è¯•çš„ç›®çš„
- `testGetUserById_WhenIdExists_ShouldReturnUser()` - æè¿°åœºæ™¯å’Œé¢„æœŸç»“æœ
- `testDeleteUser_WhenUserNotExists_ShouldThrowException()` - æè¿°å¼‚å¸¸åœºæ™¯

**ä¸å¥½çš„å‘½å**ï¼š
- `test1()` - æ— æ³•çŸ¥é“æµ‹è¯•å†…å®¹
- `test()` - å¤ªç¬¼ç»Ÿ
- `testUser()` - ä¸æ¸…æ¥šæµ‹è¯•çš„å…·ä½“åŠŸèƒ½

### âœ… 2. æµ‹è¯•æ–¹æ³•ç»“æ„ï¼ˆGiven-When-Thenæ¨¡å¼ï¼‰

```java
@Test
public void testAddUser() {
    // Given: å‡†å¤‡æµ‹è¯•æ•°æ®å’Œç¯å¢ƒ
    String username = "testUser";
    User user = new User();
    user.setUsername(username);
    
    // When: æ‰§è¡Œè¢«æµ‹è¯•çš„æ–¹æ³•
    User result = userService.addUser(user);
    
    // Then: éªŒè¯ç»“æœ
    assertNotNull(result);
    assertEquals(username, result.getUsername());
}
```

### âœ… 3. æµ‹è¯•éš”ç¦»æ€§

- **æ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹**ï¼šä¸ä¾èµ–å…¶ä»–æµ‹è¯•çš„æ‰§è¡Œç»“æœ
- **ä½¿ç”¨@Beforeå’Œ@After**ï¼šå‡†å¤‡å’Œæ¸…ç†æµ‹è¯•ç¯å¢ƒ
- **é¿å…å…±äº«çŠ¶æ€**ï¼šä¸è¦ä½¿ç”¨é™æ€å˜é‡åœ¨æµ‹è¯•é—´å…±äº«æ•°æ®

```java
public class UserServiceTest {
    private User testUser;  // æ¯ä¸ªæµ‹è¯•éƒ½æœ‰ç‹¬ç«‹çš„å®ä¾‹
    
    @Before
    public void setUp() {
        testUser = new User();  // æ¯ä¸ªæµ‹è¯•å‰éƒ½åˆ›å»ºæ–°å®ä¾‹
        testUser.setUsername("test");
    }
    
    @After
    public void tearDown() {
        testUser = null;  // æ¸…ç†èµ„æº
    }
}
```

### âœ… 4. æµ‹è¯•æ–­è¨€

**ä½¿ç”¨æ¸…æ™°çš„æ–­è¨€æ¶ˆæ¯**ï¼š

```java
// âŒ ä¸å¥½çš„æ–­è¨€
assertNotNull(user);
assertEquals(id, user.getId());

// âœ… å¥½çš„æ–­è¨€ï¼ˆå¸¦æ¶ˆæ¯ï¼‰
assertNotNull("ç”¨æˆ·ä¸åº”è¯¥ä¸ºnull", user);
assertEquals("ç”¨æˆ·IDåº”è¯¥åŒ¹é…", id, user.getId());
```

**ä½¿ç”¨AssertJï¼ˆæ›´æµç•…çš„æ–­è¨€ï¼‰**ï¼š

```java
import static org.assertj.core.api.Assertions.*;

assertThat(user).isNotNull();
assertThat(user.getId()).isEqualTo(id);
assertThat(user.getUsername()).startsWith("test");
```

### âœ… 5. æµ‹è¯•å¼‚å¸¸åœºæ™¯

```java
@Test(expected = IllegalArgumentException.class)
public void testAddUser_WhenUsernameIsNull_ShouldThrowException() {
    // Given
    User user = new User();
    user.setUsername(null);
    
    // When & Then
    userService.addUser(user);  // åº”è¯¥æŠ›å‡ºIllegalArgumentException
}

// æˆ–è€…ä½¿ç”¨try-catch
@Test
public void testAddUser_WhenUsernameIsNull_ShouldThrowException() {
    // Given
    User user = new User();
    user.setUsername(null);
    
    // When & Then
    try {
        userService.addUser(user);
        fail("åº”è¯¥æŠ›å‡ºå¼‚å¸¸");  // å¦‚æœæ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œæµ‹è¯•å¤±è´¥
    } catch (IllegalArgumentException e) {
        assertEquals("ç”¨æˆ·åä¸èƒ½ä¸ºç©º", e.getMessage());
    }
}
```

### âœ… 6. æµ‹è¯•è¦†ç›–ç‡å»ºè®®

- **å…³é”®ä¸šåŠ¡é€»è¾‘**ï¼š100%è¦†ç›–
- **å·¥å…·æ–¹æ³•**ï¼š80%ä»¥ä¸Šè¦†ç›–
- **ç®€å•çš„getter/setter**ï¼šå¯ä»¥å¿½ç•¥
- **å¼‚å¸¸å¤„ç†**ï¼šç¡®ä¿å¼‚å¸¸è·¯å¾„è¢«æµ‹è¯•

### âœ… 7. æµ‹è¯•æ€§èƒ½

- **å¿«é€Ÿæµ‹è¯•**ï¼šå•å…ƒæµ‹è¯•åº”è¯¥å¿«é€Ÿæ‰§è¡Œï¼ˆæ¯«ç§’çº§ï¼‰
- **é¿å…çœŸå®å¤–éƒ¨ä¾èµ–**ï¼šä½¿ç”¨Mockå¯¹è±¡æ›¿ä»£æ•°æ®åº“ã€ç½‘ç»œè¯·æ±‚ç­‰
- **æ‰¹é‡è¿è¡Œ**ï¼šç¡®ä¿æ‰€æœ‰æµ‹è¯•èƒ½åœ¨åˆç†æ—¶é—´å†…å®Œæˆ

### âœ… 8. æµ‹è¯•æ•°æ®ç®¡ç†

```java
public class UserServiceTest {
    
    @Before
    public void setUp() {
        // å‡†å¤‡æµ‹è¯•æ•°æ®
        // å¯ä»¥è¯»å–æµ‹è¯•é…ç½®æ–‡ä»¶
        // æˆ–è€…ä½¿ç”¨æµ‹è¯•æ•°æ®åº“
    }
    
    @After
    public void tearDown() {
        // æ¸…ç†æµ‹è¯•æ•°æ®
        // ç¡®ä¿ä¸å½±å“å…¶ä»–æµ‹è¯•
    }
    
    // ä¹Ÿå¯ä»¥ä½¿ç”¨æµ‹è¯•ä¸“ç”¨çš„é…ç½®æ–‡ä»¶
    // @TestPropertySource(locations = "classpath:test.properties")
}
```

---

## 3.7 SpringBootæ•´åˆRedis

SpringBootæ•´åˆRedisæ˜¯æŒ‡åœ¨Spring Bootåº”ç”¨ä¸­ï¼Œä½¿ç”¨Redisä½œä¸ºç¼“å­˜ã€ä¼šè¯å­˜å‚¨æˆ–æ¶ˆæ¯é˜Ÿåˆ—ã€‚Spring Bootæä¾›äº†å¯¹Redisçš„è‡ªåŠ¨é…ç½®æ”¯æŒï¼Œå¯ä»¥å¿«é€Ÿé›†æˆRedisã€‚

Redisæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å†…å­˜æ•°æ®åº“ï¼Œå¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š
- **ç¼“å­˜**ï¼šçƒ­ç‚¹æ•°æ®ç¼“å­˜ï¼Œæå‡åº”ç”¨æ€§èƒ½
- **ä¼šè¯å­˜å‚¨**ï¼šåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„ä¼šè¯å…±äº«
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šå®ç°ç®€å•çš„æ¶ˆæ¯å‘å¸ƒè®¢é˜…
- **è®¡æ•°å™¨**ï¼šå®ç°åˆ†å¸ƒå¼è®¡æ•°å’Œé™æµåŠŸèƒ½

### ğŸ¯ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨SpringBootæ•´åˆRedisï¼Ÿ

1. **é«˜æ€§èƒ½ç¼“å­˜** ğŸš€
   - RedisåŸºäºå†…å­˜å­˜å‚¨ï¼Œè¯»å†™é€Ÿåº¦æå¿«
   - é€‚ç”¨äºçƒ­ç‚¹æ•°æ®ç¼“å­˜ï¼Œæå‡åº”ç”¨æ€§èƒ½
   - å‡å°‘æ•°æ®åº“è®¿é—®å‹åŠ›

2. **ä¸°å¯Œçš„æ•°æ®ç±»å‹** ğŸ’¾
   - æ”¯æŒStringã€Hashã€Listã€Setã€Sorted Setç­‰æ•°æ®ç»“æ„
   - æ»¡è¶³å„ç§ä¸šåŠ¡åœºæ™¯éœ€æ±‚
   - çµæ´»çš„æ•°æ®ç»“æ„æ”¯æŒå¤æ‚ä¸šåŠ¡é€»è¾‘

3. **è‡ªåŠ¨é…ç½®** âœ¨
   - Spring Bootè‡ªåŠ¨é…ç½®Redisè¿æ¥
   - æä¾›`RedisTemplate`å’Œ`StringRedisTemplate`æ¨¡æ¿ç±»
   - ç®€åŒ–Redisæ“ä½œçš„ä»£ç ç¼–å†™
   - æ— éœ€æ‰‹åŠ¨åˆ›å»ºè¿æ¥æ± 

4. **æŒä¹…åŒ–æ”¯æŒ** ğŸ’¿
   - æ”¯æŒRDBå’ŒAOFä¸¤ç§æŒä¹…åŒ–æ–¹å¼
   - ä¿è¯æ•°æ®å®‰å…¨æ€§å’Œå¯é æ€§
   - é€‚åˆç”Ÿäº§ç¯å¢ƒä½¿ç”¨

### ğŸ“¦ Redisä¾èµ–é…ç½®

åœ¨`pom.xml`ä¸­æ·»åŠ Redisä¾èµ–ï¼š

```xml
<!-- é›†æˆRedis-->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
```

### âš™ï¸ Redisé…ç½®æ–‡ä»¶

åœ¨`application-dev.yml`ï¼ˆæˆ–å…¶ä»–ç¯å¢ƒé…ç½®æ–‡ä»¶ä¸­ï¼‰é…ç½®Redisè¿æ¥ä¿¡æ¯ï¼š

```yaml
spring:
  redis:
    host: 127.0.0.1      # redisçš„ä¸»æœºIP
    port: 6379           # redisçš„ç«¯å£
    password:            # redisçš„å¯†ç ï¼ˆå¦‚æœæ²¡æœ‰è®¾ç½®å¯†ç ï¼Œç•™ç©ºï¼‰
    timeout: 10000       # redisçš„è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
```

**é…ç½®è¯´æ˜**ï¼š
- `host`ï¼šRedisæœåŠ¡å™¨åœ°å€ï¼Œé»˜è®¤`localhost`
- `port`ï¼šRedisç«¯å£ï¼Œé»˜è®¤`6379`
- `password`ï¼šRediså¯†ç ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®å¯†ç å¯ä»¥ç•™ç©º
- `timeout`ï¼šè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ¯«ç§’

### ğŸ”§ æ ¸å¿ƒç»„ä»¶

#### RedisTemplate

`RedisTemplate`æ˜¯Springæä¾›çš„ä¸€ä¸ªç”¨äºæ“ä½œRedisçš„æ¨¡æ¿ç±»ï¼Œå®ƒæä¾›äº†ä¸°å¯Œçš„æ“ä½œæ–¹æ³•ã€‚

**é‡è¦é—®é¢˜ï¼šåºåˆ—åŒ–é…ç½®**

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`RedisTemplate`ä½¿ç”¨JDKåºåˆ—åŒ–ï¼Œè¿™ä¼šå¯¼è‡´ï¼š
- å­˜å‚¨çš„æ•°æ®ä¸å¯è¯»
- å­˜å€¼å‡ºç°ä¹±ç 
- å†…å­˜å ç”¨è¾ƒå¤§

**è§£å†³æ–¹æ¡ˆ**ï¼šé…ç½®åºåˆ—åŒ–å™¨ï¼Œä½¿ç”¨`StringRedisSerializer`

### ğŸ“ æœåŠ¡ç±»å®ç°

åˆ›å»º`RedisServiceImpl`æœåŠ¡ç±»ï¼š

```12:52:src/main/java/org/example/service/RedisServiceImpl.java
/**
 * RedisæœåŠ¡å®ç°ç±»
 * @author yangzhao
 */
@Service
public class RedisServiceImpl {

    @Resource
    private RedisTemplate redisTemplate;

    /**
     * è®¾ç½®RedisTemplateï¼Œè§£å†³å­˜å€¼ä¹±ç çš„é—®é¢˜
     * @param redisTemplate RedisTemplate
     */
    @Autowired(required = false)
    public void setRedisTemplate(RedisTemplate redisTemplate) {
        StringRedisSerializer stringRedisSerializer = new StringRedisSerializer();
        redisTemplate.setKeySerializer(stringRedisSerializer);
        redisTemplate.setValueSerializer(stringRedisSerializer);
        redisTemplate.setHashKeySerializer(stringRedisSerializer);
        redisTemplate.setHashValueSerializer(stringRedisSerializer);
        this.redisTemplate = redisTemplate;
    }

    /**
     * è®¾ç½®Redisæ•°æ®ï¼Œé»˜è®¤è¿‡æœŸæ—¶é—´ 60 ç§’
     * @param key é”®
     * @param value å€¼
     */
    public void setKey(String key, String value) {
        redisTemplate.opsForValue().set(key, value, 60, TimeUnit.SECONDS);
    }

    /**
     * è·å–Redisæ•°æ®
     * @param key é”®
     * @return å€¼
     */
    public String getKey(String key) {
        return redisTemplate.opsForValue().get(key).toString();
    }
}
```

### ğŸ” ä»£ç è§£æ

1. **@Serviceæ³¨è§£**
   - å°†ç±»å£°æ˜ä¸ºSpringç®¡ç†çš„æœåŠ¡Bean

2. **@Resourceæ³¨å…¥RedisTemplate**
   - æ³¨å…¥Spring Bootè‡ªåŠ¨é…ç½®çš„`RedisTemplate`å®ä¾‹
   - å¯ä»¥ç”¨`@Autowired`æ›¿ä»£

3. **åºåˆ—åŒ–é…ç½®ï¼ˆå…³é”®ï¼‰**
   ```java
   @Autowired(required = false)
   public void setRedisTemplate(RedisTemplate redisTemplate) {
       StringRedisSerializer stringRedisSerializer = new StringRedisSerializer();
       redisTemplate.setKeySerializer(stringRedisSerializer);
       redisTemplate.setValueSerializer(stringRedisSerializer);
       redisTemplate.setHashKeySerializer(stringRedisSerializer);
       redisTemplate.setHashValueSerializer(stringRedisSerializer);
       this.redisTemplate = redisTemplate;
   }
   ```
   - ä½¿ç”¨`StringRedisSerializer`ç»Ÿä¸€åºåˆ—åŒ–Keyå’ŒValue
   - è§£å†³å­˜å‚¨ä¹±ç é—®é¢˜
   - `required = false`è¡¨ç¤ºå¦‚æœæ²¡æœ‰RedisTemplateï¼Œä¸ä¼šæŠ¥é”™

4. **setKeyæ–¹æ³•**
   - `redisTemplate.opsForValue().set(key, value, timeout, timeUnit)`
   - è®¾ç½®é”®å€¼å¯¹ï¼Œå¹¶æŒ‡å®šè¿‡æœŸæ—¶é—´
   - é»˜è®¤è¿‡æœŸæ—¶é—´ä¸º60ç§’

5. **getKeyæ–¹æ³•**
   - `redisTemplate.opsForValue().get(key)`
   - æ ¹æ®é”®è·å–å€¼

### ğŸ§ª æµ‹è¯•ç±»å®ç°

åˆ›å»º`RedisServiceImplTest`æµ‹è¯•ç±»ï¼š

```12:43:src/test/java/org/example/service/RedisServiceImplTest.java
@SpringBootTest
@RunWith(SpringRunner.class)
public class RedisServiceImplTest {

    @Resource
    private RedisServiceImpl redisService;

    private String key = "name";
    private String value = "yangzhao";

    @Before
    public void setUp() throws Exception {
        System.out.println("å¼€å§‹æµ‹è¯•");
        redisService.setKey("name", "yangzhao");
        System.out.println(redisService.getKey("name"));
    }

    @After
    public void tearDown() throws Exception {
        System.out.println("ç»“æŸæµ‹è¯•");
    }

    @Test
    public void testSetKey() {
        redisService.setKey(key, value);
    }

    @Test
    public void testGetKey() {
        String result = redisService.getKey(key);
        System.out.println("è·å–çš„å€¼ä¸º: " + result);
    }
}
```

### ğŸ” æµ‹è¯•ä»£ç è§£æ

1. **@SpringBootTest**
   - åŠ è½½Spring Bootåº”ç”¨ä¸Šä¸‹æ–‡
   - è‡ªåŠ¨é…ç½®Redisè¿æ¥

2. **@RunWith(SpringRunner.class)**
   - ä½¿ç”¨Springæµ‹è¯•è¿è¡Œå™¨
   - å¯ç”¨Springæµ‹è¯•åŠŸèƒ½

3. **@Resourceæ³¨å…¥æœåŠ¡**
   - æ³¨å…¥`RedisServiceImpl`å®ä¾‹
   - åœ¨æµ‹è¯•ä¸­ä½¿ç”¨RedisæœåŠ¡

4. **@Before / @After**
   - æµ‹è¯•å‰ç½®å’Œåç½®å¤„ç†
   - å¯ä»¥åœ¨`setUp`ä¸­å‡†å¤‡æµ‹è¯•æ•°æ®
   - åœ¨`tearDown`ä¸­æ¸…ç†æµ‹è¯•ç¯å¢ƒ

### â–¶ï¸ è¿è¡Œæµ‹è¯•

#### å‰ç½®æ¡ä»¶

ç¡®ä¿RedisæœåŠ¡å™¨å·²å¯åŠ¨ï¼š

```bash
# æ£€æŸ¥Redisæ˜¯å¦è¿è¡Œ
redis-cli ping
# å¦‚æœè¿”å› PONGï¼Œè¯´æ˜Redisæ­£å¸¸è¿è¡Œ
```

#### è¿è¡Œæµ‹è¯•

1. **ä½¿ç”¨IDEè¿è¡Œ**ï¼šå³é”®ç‚¹å‡»æµ‹è¯•ç±»ï¼Œé€‰æ‹©"Run RedisServiceImplTest"
2. **ä½¿ç”¨Mavenå‘½ä»¤**ï¼š
   ```bash
   mvn test -Dtest=RedisServiceImplTest
   ```

### ğŸ¯ Rediså¸¸ç”¨æ“ä½œ

`RedisTemplate`æä¾›äº†ä¸°å¯Œçš„æ“ä½œæ–¹æ³•ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨ç¤ºä¾‹ï¼š

#### Stringæ“ä½œ

```java
// è®¾ç½®å€¼
redisTemplate.opsForValue().set("key", "value");

// è®¾ç½®å€¼å¹¶æŒ‡å®šè¿‡æœŸæ—¶é—´
redisTemplate.opsForValue().set("key", "value", 60, TimeUnit.SECONDS);

// è·å–å€¼
String value = redisTemplate.opsForValue().get("key");

// åˆ é™¤é”®
redisTemplate.delete("key");

// åˆ¤æ–­é”®æ˜¯å¦å­˜åœ¨
Boolean exists = redisTemplate.hasKey("key");

// è®¾ç½®è¿‡æœŸæ—¶é—´
redisTemplate.expire("key", 60, TimeUnit.SECONDS);
```

#### Hashæ“ä½œ

```java
// è®¾ç½®Hashå€¼
redisTemplate.opsForHash().put("hashKey", "field", "value");

// è·å–Hashå€¼
Object value = redisTemplate.opsForHash().get("hashKey", "field");

// è·å–æ‰€æœ‰Hashå­—æ®µå’Œå€¼
Map<Object, Object> map = redisTemplate.opsForHash().entries("hashKey");
```

#### Listæ“ä½œ

```java
// ä»å·¦ä¾§æ¨å…¥
redisTemplate.opsForList().leftPush("listKey", "value");

// ä»å³ä¾§æ¨å…¥
redisTemplate.opsForList().rightPush("listKey", "value");

// è·å–åˆ—è¡¨èŒƒå›´
List<String> list = redisTemplate.opsForList().range("listKey", 0, -1);
```

#### Setæ“ä½œ

```java
// æ·»åŠ å…ƒç´ 
redisTemplate.opsForSet().add("setKey", "value1", "value2");

// è·å–æ‰€æœ‰æˆå‘˜
Set<String> members = redisTemplate.opsForSet().members("setKey");

// åˆ¤æ–­æ˜¯å¦ä¸ºæˆå‘˜
Boolean isMember = redisTemplate.opsForSet().isMember("setKey", "value");
```

### ğŸ“‹ Redisæœ€ä½³å®è·µ

1. **åºåˆ—åŒ–é…ç½®**
   - âœ… ä½¿ç”¨`StringRedisSerializer`è¿›è¡Œå­—ç¬¦ä¸²åºåˆ—åŒ–
   - âœ… é’ˆå¯¹ä¸åŒæ•°æ®ç±»å‹é€‰æ‹©åˆé€‚çš„åºåˆ—åŒ–å™¨
   - âŒ é¿å…ä½¿ç”¨é»˜è®¤çš„JDKåºåˆ—åŒ–ï¼ˆä¼šäº§ç”Ÿä¹±ç ï¼‰

2. **è¿‡æœŸæ—¶é—´è®¾ç½®**
   - âœ… æ ¹æ®ä¸šåŠ¡éœ€æ±‚åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´
   - âœ… é¿å…ç¼“å­˜æ•°æ®æ°¸ä¹…å­˜å‚¨å ç”¨å†…å­˜
   - âœ… ä½¿ç”¨`expire`æ–¹æ³•åŠ¨æ€è®¾ç½®è¿‡æœŸæ—¶é—´

3. **å¼‚å¸¸å¤„ç†**
   - âœ… æ•è·`RedisConnectionException`ç­‰å¼‚å¸¸
   - âœ… å½“Redisä¸å¯ç”¨æ—¶ï¼Œé™çº§åˆ°æ•°æ®åº“æŸ¥è¯¢
   - âœ… è®°å½•æ—¥å¿—ä¾¿äºé—®é¢˜æ’æŸ¥

4. **é”®å‘½åè§„èŒƒ**
   - âœ… ä½¿ç”¨æœ‰æ„ä¹‰çš„é”®åï¼Œå¦‚`user:123`ã€`order:456`
   - âœ… ä½¿ç”¨å†’å·åˆ†éš”ä¸åŒçš„å±‚çº§
   - âœ… é¿å…é”®åè¿‡é•¿ï¼Œå½±å“æ€§èƒ½

5. **è¿æ¥æ± é…ç½®**
   - âœ… é…ç½®åˆé€‚çš„è¿æ¥æ± å¤§å°
   - âœ… è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´
   - âœ… ç›‘æ§è¿æ¥æ± ä½¿ç”¨æƒ…å†µ

### ğŸš¨ å¸¸è§é—®é¢˜

#### é—®é¢˜1ï¼šå­˜å‚¨çš„æ•°æ®ä¹±ç 

**åŸå› **ï¼šä½¿ç”¨é»˜è®¤çš„JDKåºåˆ—åŒ–å™¨

**è§£å†³æ–¹æ¡ˆ**ï¼šé…ç½®`StringRedisSerializer`
```java
redisTemplate.setKeySerializer(new StringRedisSerializer());
redisTemplate.setValueSerializer(new StringRedisSerializer());
```

#### é—®é¢˜2ï¼šè¿æ¥Rediså¤±è´¥

**æ£€æŸ¥é¡¹**ï¼š
- RedisæœåŠ¡æ˜¯å¦å¯åŠ¨
- ä¸»æœºåœ°å€å’Œç«¯å£æ˜¯å¦æ­£ç¡®
- å¯†ç æ˜¯å¦æ­£ç¡®ï¼ˆå¦‚æœè®¾ç½®äº†å¯†ç ï¼‰
- é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ç›¸åº”ç«¯å£

#### é—®é¢˜3ï¼šè·å–å€¼ä¸ºnull

**å¯èƒ½åŸå› **ï¼š
- é”®ä¸å­˜åœ¨
- é”®å·²è¿‡æœŸ
- åºåˆ—åŒ–æ–¹å¼ä¸ä¸€è‡´å¯¼è‡´æ— æ³•è¯»å–

### ğŸ“ æ‰©å±•å­¦ä¹ 

- **Redisé›†ç¾¤**ï¼šå­¦ä¹ Redis Clusteré…ç½®
- **Lettuceè¿æ¥æ± **ï¼šäº†è§£Spring Boot 2.xé»˜è®¤ä½¿ç”¨çš„Lettuceå®¢æˆ·ç«¯
- **ç¼“å­˜æ³¨è§£**ï¼šå­¦ä¹ `@Cacheable`ã€`@CacheEvict`ç­‰æ³¨è§£
- **åˆ†å¸ƒå¼é”**ï¼šä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šä½¿ç”¨Redisçš„Pub/SubåŠŸèƒ½

---

## 3.8 æ€»ç»“

æœ¬æ–‡æ¡£ä»‹ç»äº†Spring Bootçš„ä¸¤ä¸ªé‡è¦æ•´åˆï¼šJUnitæµ‹è¯•æ¡†æ¶å’ŒRedisç¼“å­˜ã€‚

### ğŸ¯ JUnitæµ‹è¯•æ ¸å¿ƒè¦ç‚¹

1. **ä¾èµ–é…ç½®**
   - ä½¿ç”¨`spring-boot-starter-test`èµ·æ­¥ä¾èµ–
   - è‡ªåŠ¨åŒ…å«JUnitã€Mockitoã€AssertJç­‰æµ‹è¯•æ¡†æ¶

2. **æ ¸å¿ƒæ³¨è§£**
   - `@SpringBootTest` - åŠ è½½Springåº”ç”¨ä¸Šä¸‹æ–‡
   - `@RunWith(SpringRunner.class)` - ä½¿ç”¨Springæµ‹è¯•è¿è¡Œå™¨
   - `@Test` - æ ‡è®°æµ‹è¯•æ–¹æ³•
   - `@Before/@After` - æµ‹è¯•å‰åå¤„ç†

3. **ä¾èµ–æ³¨å…¥**
   - ä½¿ç”¨`@Autowired`æˆ–`@Resource`æ³¨å…¥Spring Bean
   - æµ‹è¯•ä»£ç å¯ä»¥ä½¿ç”¨å®Œæ•´çš„SpringåŠŸèƒ½

### ğŸ“‹ JUnitæµ‹è¯•æµç¨‹

```
1. åˆ›å»ºæµ‹è¯•ç±»
   â†“
2. æ·»åŠ @RunWithå’Œ@SpringBootTestæ³¨è§£
   â†“
3. æ³¨å…¥éœ€è¦æµ‹è¯•çš„Bean
   â†“
4. ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼ˆä½¿ç”¨@Testæ³¨è§£ï¼‰
   â†“
5. è¿è¡Œæµ‹è¯•å¹¶éªŒè¯ç»“æœ
```

### ğŸ¯ Redisæ•´åˆæ ¸å¿ƒè¦ç‚¹

1. **ä¾èµ–é…ç½®**
   - ä½¿ç”¨`spring-boot-starter-data-redis`èµ·æ­¥ä¾èµ–
   - Spring Bootè‡ªåŠ¨é…ç½®Redisè¿æ¥

2. **é…ç½®æ–‡ä»¶**
   - åœ¨`application.yml`ä¸­é…ç½®Redisè¿æ¥ä¿¡æ¯
   - åŒ…å«hostã€portã€passwordã€timeoutç­‰é…ç½®é¡¹

3. **æ ¸å¿ƒç»„ä»¶**
   - `RedisTemplate` - Redisæ“ä½œæ¨¡æ¿ç±»
   - ä½¿ç”¨`StringRedisSerializer`è§£å†³åºåˆ—åŒ–ä¹±ç é—®é¢˜

4. **å¸¸ç”¨æ“ä½œ**
   - Stringæ“ä½œï¼š`opsForValue()`
   - Hashæ“ä½œï¼š`opsForHash()`
   - Listæ“ä½œï¼š`opsForList()`
   - Setæ“ä½œï¼š`opsForSet()`

### âœ… æœ€ä½³å®è·µ

| æœ€ä½³å®è·µ | è¯´æ˜ |
|--------|------|
| å‘½åè§„èŒƒ | ä½¿ç”¨æ¸…æ™°çš„æµ‹è¯•æ–¹æ³•åï¼Œæè¿°æµ‹è¯•ç›®çš„ |
| æµ‹è¯•éš”ç¦» | æ¯ä¸ªæµ‹è¯•æ–¹æ³•ç›¸äº’ç‹¬ç«‹ |
| ä½¿ç”¨æ–­è¨€ | éªŒè¯æµ‹è¯•ç»“æœçš„æ­£ç¡®æ€§ |
| æµ‹è¯•è¦†ç›– | ç¡®ä¿å…³é”®ä¸šåŠ¡é€»è¾‘è¢«æµ‹è¯• |
| å¼‚å¸¸æµ‹è¯• | æµ‹è¯•å¼‚å¸¸åœºæ™¯çš„å¤„ç† |
| åºåˆ—åŒ–é…ç½® | Redisä½¿ç”¨StringRedisSerializeré¿å…ä¹±ç  |
| è¿‡æœŸæ—¶é—´ | åˆç†è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´ |
| é”®å‘½åè§„èŒƒ | ä½¿ç”¨æœ‰æ„ä¹‰çš„é”®åï¼Œå¦‚`user:123` |

### ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ 

#### æµ‹è¯•ç›¸å…³
- **Mockæµ‹è¯•**ï¼šå­¦ä¹ ä½¿ç”¨Mockitoæ¨¡æ‹Ÿä¾èµ–å¯¹è±¡
- **Webæµ‹è¯•**ï¼šå­¦ä¹ ä½¿ç”¨MockMvcæµ‹è¯•Webæ¥å£
- **æ•°æ®åº“æµ‹è¯•**ï¼šå­¦ä¹ ä½¿ç”¨äº‹åŠ¡å›æ»š
- **æµ‹è¯•é…ç½®**ï¼šå­¦ä¹ ä½¿ç”¨`@TestPropertySource`è‡ªå®šä¹‰æµ‹è¯•é…ç½®
- **JUnit 5**ï¼šäº†è§£Spring Boot 2.2+å¯¹JUnit 5çš„æ”¯æŒ

#### Redisç›¸å…³
- **Redisé›†ç¾¤**ï¼šå­¦ä¹ Redis Clusteré…ç½®
- **ç¼“å­˜æ³¨è§£**ï¼šå­¦ä¹ `@Cacheable`ã€`@CacheEvict`ç­‰æ³¨è§£
- **åˆ†å¸ƒå¼é”**ï¼šä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šä½¿ç”¨Redisçš„Pub/SubåŠŸèƒ½
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå­¦ä¹ Redisæ€§èƒ½è°ƒä¼˜å’Œç›‘æ§

---

> **æç¤º**ï¼šé€šè¿‡ç¼–å†™æµ‹è¯•ï¼Œä¸ä»…å¯ä»¥éªŒè¯ä»£ç çš„æ­£ç¡®æ€§ï¼Œè¿˜èƒ½ä½œä¸ºä»£ç çš„æ–‡æ¡£è¯´æ˜ã€‚è‰¯å¥½çš„æµ‹è¯•ä¹ æƒ¯æ˜¯æˆä¸ºä¼˜ç§€å¼€å‘è€…çš„é‡è¦æ ‡å¿—ï¼
