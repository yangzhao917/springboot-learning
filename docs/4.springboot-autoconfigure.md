# Spring Boot è‡ªåŠ¨é…ç½®è¯¦è§£

> æ‘˜è¦ï¼ˆTL;DRï¼‰
> - ç›®æ ‡ï¼šè¯»æ‡‚å¹¶è¿ç”¨ Spring Boot è‡ªåŠ¨é…ç½®ï¼Œèƒ½ç¼–å†™è‡ªå®šä¹‰è‡ªåŠ¨é…ç½®
> - å­¦ä¼šï¼š`@EnableAutoConfiguration`ã€`@Enable`/`@Import`ã€Condition æ¡ä»¶è£…é…ã€åŠ¨æ€åŠ è½½
> - æ”¶è·ï¼šä¼šå†™ Starterã€ä¼šçœ‹æ—¶åºå›¾ã€èƒ½æ’æŸ¥ç”Ÿæ•ˆä¸å¦åŠå†²çªé—®é¢˜

## ğŸ“š ç›®å½•

- [å†…å®¹æ¦‚è§ˆ](#å†…å®¹æ¦‚è§ˆ)
- [4.1 ä»€ä¹ˆæ˜¯è‡ªåŠ¨é…ç½®](#41-ä»€ä¹ˆæ˜¯è‡ªåŠ¨é…ç½®)
- [4.2 @Enable ä¸ @Import æ³¨è§£å®ç”¨æŒ‡å—](#42-enable-ä¸-import-æ³¨è§£å®ç”¨æŒ‡å—)
- [4.3 åˆ‡æ¢å†…ç½®WebæœåŠ¡å™¨](#43-åˆ‡æ¢å†…ç½®webæœåŠ¡å™¨)
- [4.4 å¦‚ä½•ç¼–å†™è‡ªåŠ¨é…ç½®](#44-å¦‚ä½•ç¼–å†™è‡ªåŠ¨é…ç½®)
- [4.5 Conditionæ¡ä»¶æ³¨è§£çš„ä½¿ç”¨](#45-conditionæ¡ä»¶æ³¨è§£çš„ä½¿ç”¨)
- [4.6 è‡ªå®šä¹‰ Starter å®ç°](#46-è‡ªå®šä¹‰-starter-å®ç°)
- [4.7 åŠ¨æ€åŠ è½½é…ç½® excuteæµç¨‹](#47-åŠ¨æ€åŠ è½½é…ç½®)
- [4.8 è‡ªåŠ¨é…ç½®æ‰§è¡ŒåŸç†æ—¶åºå›¾](#48-è‡ªåŠ¨é…ç½®æ‰§è¡ŒåŸç†æ—¶åºå›¾)
- [4.9 ä½¿ç”¨åœºæ™¯å’Œå®è·µ](#49-ä½¿ç”¨åœºæ™¯å’Œå®è·µ)
- [4.10 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#410-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
- [4.11 æ€»ç»“](#411-æ€»ç»“)

---

## å†…å®¹æ¦‚è§ˆ

æœ¬æ–‡æ¡£å…¨é¢ä»‹ç»Spring Bootè‡ªåŠ¨é…ç½®æœºåˆ¶ï¼Œå¸®åŠ©åˆå­¦è€…æ·±å…¥ç†è§£è‡ªåŠ¨é…ç½®çš„åŸç†å’Œä½¿ç”¨æ–¹å¼ã€‚

### ğŸ“š ä¸»è¦å†…å®¹

#### ç¬¬ä¸€éƒ¨åˆ†ï¼šè‡ªåŠ¨é…ç½®åŸºç¡€
- **è‡ªåŠ¨é…ç½®æ¦‚å¿µ**ï¼šä»€ä¹ˆæ˜¯è‡ªåŠ¨é…ç½®ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨è‡ªåŠ¨é…ç½®
- **æ ¸å¿ƒæ„ä»¶**ï¼š`@EnableAutoConfiguration`ã€`spring.factories`æ–‡ä»¶ã€è‡ªåŠ¨é…ç½®ç±»ç­‰
- **å·¥ä½œåŸç†**ï¼šè‡ªåŠ¨é…ç½®å¦‚ä½•è¢«è§¦å‘å’Œæ‰§è¡Œ

#### ç¬¬äºŒéƒ¨åˆ†ï¼šè‡ªå®šä¹‰è‡ªåŠ¨é…ç½®
- **ç¼–å†™æ­¥éª¤**ï¼šåˆ›å»ºé…ç½®ç±»ã€æ¡ä»¶æ³¨è§£ã€é…ç½®å±æ€§ç±»
- **Conditionæ¡ä»¶æ³¨è§£**ï¼šå„ç§Conditionç±»å‹è¯¦è§£å’Œå®æˆ˜æ¡ˆä¾‹
- **åŠ¨æ€åŠ è½½**ï¼šå¦‚ä½•å®ç°é…ç½®çš„åŠ¨æ€åŠ è½½å’Œåˆ·æ–°

#### ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ·±å…¥åŸç†
- **æ‰§è¡Œæµç¨‹**ï¼šè‡ªåŠ¨é…ç½®çš„å®Œæ•´æ‰§è¡Œæ—¶åºå›¾
- **æºç åˆ†æ**ï¼šå…³é”®ç±»å’Œæ–¹æ³•çš„è§£æ
- **è°ƒè¯•æŠ€å·§**ï¼šå¦‚ä½•æŸ¥çœ‹å’Œè°ƒè¯•è‡ªåŠ¨é…ç½®

#### ç¬¬å››éƒ¨åˆ†ï¼šå®è·µåº”ç”¨
- **ä½¿ç”¨åœºæ™¯**ï¼šé€‚åˆä½¿ç”¨è‡ªåŠ¨é…ç½®çš„åœºæ™¯
- **æœ€ä½³å®è·µ**ï¼šç¼–å†™è‡ªåŠ¨é…ç½®çš„æœ€ä½³æ–¹å¼
- **å¸¸è§é—®é¢˜**ï¼šå¼€å‘ä¸­å¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ

### ğŸ§­ æ¨èé˜…è¯»é¡ºåºï¼ˆç”±æµ…å…¥æ·±ï¼‰
1. 4.1 ä»€ä¹ˆæ˜¯è‡ªåŠ¨é…ç½®ï¼šå…ˆç†è§£â€œå®ƒæ˜¯ä»€ä¹ˆ/ä¸ºä»€ä¹ˆéœ€è¦â€
2. 4.2 @Enable ä¸ @Importï¼šæŒæ¡â€œå¼€å…³ä¸å¯¼å…¥â€çš„åŸºæœ¬æœºåˆ¶
3. 4.10 åˆ‡æ¢å†…ç½®WebæœåŠ¡å™¨ï¼šå¿«é€Ÿå®è·µä¸€ä¸ªå¯è§æ•ˆæœçš„å°æ”¹åŠ¨
4. 4.3 å¦‚ä½•ç¼–å†™è‡ªåŠ¨é…ç½®ï¼šå¼€å§‹åŠ¨æ‰‹å†™è‡ªå·±çš„è‡ªåŠ¨é…ç½®
5. 4.4 Condition æ¡ä»¶æ³¨è§£ï¼šæŒ‰éœ€åŠ è½½çš„å…³é”®æŠ€èƒ½
6. 4.12 è‡ªå®šä¹‰ Starter å®ç°ï¼šå°è£…æˆå¯å¤ç”¨ç»„ä»¶
7. 4.5 åŠ¨æ€åŠ è½½é…ç½®ï¼šäº†è§£è¿è¡ŒæœŸå˜æ›´ä¸åˆ·æ–°
8. 4.6 è‡ªåŠ¨é…ç½®æ‰§è¡ŒåŸç†æ—¶åºå›¾ï¼šå»ºç«‹æ•´ä½“æ¨¡å‹
9. 4.7 ä½¿ç”¨åœºæ™¯å’Œå®è·µï¼šæŠŠçŸ¥è¯†æ”¾åˆ°å®é™…åœºæ™¯
10. 4.8 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆï¼šå®šä½ä¸æ’éšœ

### ğŸ”§ æ ¸å¿ƒä¾èµ–

è‡ªåŠ¨é…ç½®åŠŸèƒ½å·²ç»åŒ…å«åœ¨ä»¥ä¸‹ä¾èµ–ä¸­ï¼š

- **spring-boot-autoconfigure**ï¼šè‡ªåŠ¨é…ç½®æ ¸å¿ƒæ¨¡å—ï¼ˆå·²åŒ…å«åœ¨`spring-boot-starter`ä¸­ï¼‰
- **spring-boot-configuration-processor**ï¼šé…ç½®å…ƒæ•°æ®ç”Ÿæˆå·¥å…·ï¼ˆå¯é€‰ï¼‰
- **spring-boot-starter**ï¼šSpring BootåŸºç¡€èµ·æ­¥ä¾èµ–

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- **é›¶é…ç½®å¯åŠ¨**ï¼šæŒ‰ç…§çº¦å®šè‡ªåŠ¨é…ç½®åº”ç”¨
- **æ¡ä»¶åŒ–é…ç½®**ï¼šæ ¹æ®æ¡ä»¶å†³å®šæ˜¯å¦åŠ è½½æŸä¸ªé…ç½®
- **æŒ‰éœ€åŠ è½½**ï¼šåªåŠ è½½å®é™…éœ€è¦çš„é…ç½®
- **æ˜“äºæ‰©å±•**ï¼šå¯ä»¥è‡ªå®šä¹‰è‡ªåŠ¨é…ç½®

---

## 4.1 ä»€ä¹ˆæ˜¯è‡ªåŠ¨é…ç½®

### ğŸ¤” ä»€ä¹ˆæ˜¯è‡ªåŠ¨é…ç½®ï¼Ÿ

**è‡ªåŠ¨é…ç½®ï¼ˆAuto Configurationï¼‰**æ˜¯Spring Bootçš„æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ã€‚å®ƒèƒ½å¤Ÿæ ¹æ®é¡¹ç›®ä¸­å¼•å…¥çš„ä¾èµ–å’Œé…ç½®ï¼Œè‡ªåŠ¨é…ç½®Springåº”ç”¨ç¨‹åºéœ€è¦çš„Beanã€‚

### ğŸ’¡ ç”Ÿæ´»ä¸­çš„æ¯”å–»

æƒ³è±¡ä½ è¦åšä¸€é“èœï¼š
- **ä¼ ç»Ÿæ–¹å¼ï¼ˆSpringï¼‰**ï¼šä½ éœ€è¦è‡ªå·±å‡†å¤‡æ‰€æœ‰é£Ÿæå’Œè°ƒæ–™ï¼ŒæŒ‰ç…§èœè°±ä¸€æ­¥æ­¥æ“ä½œ
- **è‡ªåŠ¨é…ç½®ï¼ˆSpring Bootï¼‰**ï¼šä½ åªéœ€è¦å‘Šè¯‰ç³»ç»Ÿ"æˆ‘è¦åšå®«ä¿é¸¡ä¸"ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å‡†å¤‡å¥½æ‰€æœ‰éœ€è¦çš„é£Ÿæå’Œè°ƒæ–™ï¼Œä½ ç›´æ¥å¼€åšå°±è¡Œï¼

### ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦è‡ªåŠ¨é…ç½®ï¼Ÿ

#### ä¼ ç»ŸSpringå¼€å‘çš„é—®é¢˜

```java
// ä¼ ç»ŸSpringé…ç½® - éœ€è¦å¤§é‡XMLæˆ–Javaé…ç½®
@Configuration
public class DataSourceConfig {
    @Bean
    public DataSource dataSource() {
        HikariConfig config = new HikariConfig();
        config.setJdbcUrl("jdbc:mysql://localhost:3306/mydb");
        config.setUsername("root");
        config.setPassword("123456");
        config.setDriverClassName("com.mysql.cj.jdbc.Driver");
        // ... æ›´å¤šé…ç½®
        return new HikariDataSource(config);
    }
}
```

#### Spring Bootè‡ªåŠ¨é…ç½®çš„è§£å†³æ–¹æ¡ˆ

```java
// Spring Boot - åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šè¿æ¥ä¿¡æ¯
// application.properties
spring.datasource.url=jdbc:mysql://localhost:3306/mydb
spring.datasource.username=root
spring.datasource.password=123456
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
```

Spring Bootä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ä½ é…ç½®äº†æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼Œç„¶åè‡ªåŠ¨åˆ›å»º`DataSource` Beanï¼

### âœ¨ è‡ªåŠ¨é…ç½®çš„ä¼˜åŠ¿

| ç‰¹æ€§ | ä¼ ç»ŸSpring | Spring Bootè‡ªåŠ¨é…ç½® |
|------|-----------|-------------------|
| é…ç½®å¤æ‚åº¦ | ğŸŸ¥ é«˜ | ğŸŸ¢ ä½ |
| ä»£ç é‡ | ğŸŸ¥ å¤š | ğŸŸ¢ å°‘ |
| å­¦ä¹ æ›²çº¿ | ğŸŸ¥ é™¡å³­ | ğŸŸ¢ å¹³ç¼“ |
| å‡ºé”™æ¦‚ç‡ | ğŸŸ¥ é«˜ | ğŸŸ¢ ä½ |
| å¼€å‘æ•ˆç‡ | ğŸŸ¥ æ…¢ | ğŸŸ¢ å¿« |

### ğŸ” è‡ªåŠ¨é…ç½®å·¥ä½œåŸç†

1. **æ‰«ææ¡ä»¶**ï¼šæ£€æŸ¥classpathä¸‹æ˜¯å¦æœ‰ç‰¹å®šçš„ç±»
2. **æ£€æŸ¥é…ç½®**ï¼šæŸ¥çœ‹é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡
3. **åˆ›å»ºBean**ï¼šå¦‚æœæ¡ä»¶æ»¡è¶³ï¼Œè‡ªåŠ¨åˆ›å»ºç›¸åº”çš„Bean
4. **åº”ç”¨é…ç½®**ï¼šå°†é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§åº”ç”¨åˆ°Beanä¸Š

---

## 4.2 @Enable ä¸ @Import æ³¨è§£å®ç”¨æŒ‡å—

### ğŸ§  å¿«é€Ÿç†è§£
- `@EnableXxx`ï¼šä¸€ä¸ªâ€œå¼€å…³â€æ³¨è§£ï¼Œæ‰“å¼€æŸä¸ªåŠŸèƒ½
- `@Import`ï¼šæŠŠæŸäº›é…ç½®ç±»/Bean å®šä¹‰â€œå¯¼å…¥â€åˆ°å®¹å™¨

`@EnableXxx` çš„æœ¬è´¨å°±æ˜¯â€œæ³¨è§£ + @Importâ€ã€‚

### 1) ç›´æ¥å¯¼å…¥é…ç½®ç±»ï¼ˆæœ€ç®€å•ï¼‰

```java
// ä¸šåŠ¡é…ç½®ç±»
@Configuration
public class FeatureConfiguration {
    @Bean
    public FeatureService featureService() {
        return new FeatureService();
    }
}

// å¼€å…³æ³¨è§£
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Import(FeatureConfiguration.class)
public @interface EnableFeature {}

// ä½¿ç”¨
@EnableFeature
@SpringBootApplication
public class App {}
```

### 2) ä½¿ç”¨ ImportSelectorï¼ˆæŒ‰æ¡ä»¶/åç§°åŠ¨æ€é€‰æ‹©ï¼‰

```java
public class FeatureImportSelector implements ImportSelector {
    @Override
    public String[] selectImports(AnnotationMetadata metadata) {
        // å¯ä»¥æŒ‰ç¯å¢ƒ/é…ç½®è¿”å›ä¸åŒé…ç½®ç±»
        return new String[]{"org.example.config.FeatureConfiguration"};
    }
}

@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Import(FeatureImportSelector.class)
public @interface EnableFeature {}
```

### 3) ä½¿ç”¨ ImportBeanDefinitionRegistrarï¼ˆæ‰‹å·¥æ³¨å†Œ Beanï¼‰

```java
public class FeatureRegistrar implements ImportBeanDefinitionRegistrar {
    @Override
    public void registerBeanDefinitions(AnnotationMetadata meta, BeanDefinitionRegistry registry) {
        RootBeanDefinition bd = new RootBeanDefinition(FeatureService.class);
        registry.registerBeanDefinition("featureService", bd);
    }
}

@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Import(FeatureRegistrar.class)
public @interface EnableFeature {}
```

### 4) @EnableAutoConfiguration æ·±å…¥
- å®ƒæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ª `@Enable` æ³¨è§£ï¼šå†…éƒ¨é€šè¿‡ `@Import(AutoConfigurationImportSelector.class)` æŠŠè‡ªåŠ¨é…ç½®ç±»æ‰¹é‡å¯¼å…¥
- æ’é™¤æ–¹å¼ï¼š

```java
@SpringBootApplication(exclude = {DataSourceAutoConfiguration.class})
public class App {}
```

```properties
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
```

---

## 4.3 åˆ‡æ¢å†…ç½®WebæœåŠ¡å™¨

### ğŸ¤” èƒŒæ™¯
Spring Boot Web é»˜è®¤ä½¿ç”¨å†…ç½® Tomcatã€‚ä½ ä¹Ÿå¯ä»¥åˆ‡æ¢ä¸º Jetty æˆ– Undertowï¼Œå¸¸è§éœ€æ±‚åŒ…æ‹¬æ›´è½»é‡ã€æ›´å°‘å†…å­˜å ç”¨æˆ–æ›´é€‚åˆé•¿è¿æ¥ã€‚

### ğŸ“¦ åˆ‡æ¢åˆ° Jettyï¼ˆæ¨èæ–¹å¼ï¼‰

åœ¨ `pom.xml` ä¸­ï¼š

```xml
<dependencies>
    <!-- Web èµ·æ­¥ï¼Œæ’é™¤ Tomcat -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
        <exclusions>
            <exclusion>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-tomcat</artifactId>
            </exclusion>
        </exclusions>
    </dependency>

    <!-- å¼•å…¥ Jetty -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-jetty</artifactId>
    </dependency>
</dependencies>
```

### ğŸ“¦ åˆ‡æ¢åˆ° Undertow

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
        <exclusions>
            <exclusion>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-tomcat</artifactId>
            </exclusion>
        </exclusions>
    </dependency>

    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-undertow</artifactId>
    </dependency>
</dependencies>
```

### ğŸ”§ å¯é€‰é…ç½®

```properties
# å¸¸ç”¨
server.port=8080
server.tomcat.max-threads=200   # ä»… Tomcat ç”Ÿæ•ˆ
server.jetty.threads.max=200    # ä»… Jetty ç”Ÿæ•ˆ
server.undertow.threads.worker=64  # ä»… Undertow ç”Ÿæ•ˆ

# å¼€å¯ HTTP/2ï¼ˆéœ€è¦ JDK ä¸å®¹å™¨æ”¯æŒï¼‰
server.http2.enabled=true
```

### âœ… é€‰æ‹©å»ºè®®
- Tomcatï¼šé»˜è®¤ã€é€šç”¨åœºæ™¯çš†å¯
- Jettyï¼šæ›´è½»é‡ï¼Œé•¿è¿æ¥ã€ä½å†…å­˜å ç”¨æ›´å‹å¥½
- Undertowï¼šé«˜å¹¶å‘ã€å¼‚æ­¥ I/O é€‚é…æ›´å¥½

---

## 4.4 å¦‚ä½•ç¼–å†™è‡ªåŠ¨é…ç½®

### ğŸ¯ ç¼–å†™æ­¥éª¤æ¦‚è§ˆ

ç¼–å†™è‡ªåŠ¨é…ç½®ç±»é€šå¸¸éœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š

1. **åˆ›å»ºé…ç½®å±æ€§ç±»**ï¼šç”¨äºç»‘å®šé…ç½®æ–‡ä»¶çš„å±æ€§
2. **åˆ›å»ºè‡ªåŠ¨é…ç½®ç±»**ï¼šåŒ…å«Beanå®šä¹‰å’Œæ¡ä»¶æ³¨è§£
3. **æ³¨å†Œè‡ªåŠ¨é…ç½®ç±»**ï¼šåœ¨`spring.factories`ä¸­æ³¨å†Œ
4. **æµ‹è¯•éªŒè¯**ï¼šç¡®ä¿è‡ªåŠ¨é…ç½®æ­£å¸¸å·¥ä½œ

### ğŸ“ å®æˆ˜æ¡ˆä¾‹ï¼šè‡ªå®šä¹‰Redisè‡ªåŠ¨é…ç½®

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„è‡ªåŠ¨é…ç½®ç¤ºä¾‹ã€‚

#### æ­¥éª¤1ï¼šåˆ›å»ºé…ç½®å±æ€§ç±»

```java
package org.example.autoconfigure.redis;

import org.springframework.boot.context.properties.ConfigurationProperties;

/**
 * Redisé…ç½®å±æ€§ç±»
 * ç”¨äºç»‘å®šé…ç½®æ–‡ä»¶ä¸­çš„ my.redis.* å±æ€§
 */
@ConfigurationProperties(prefix = "my.redis")
public class MyRedisProperties {
    
    /**
     * RedisæœåŠ¡å™¨åœ°å€
     */
    private String host = "localhost";
    
    /**
     * RedisæœåŠ¡å™¨ç«¯å£
     */
    private int port = 6379;
    
    /**
     * è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
     */
    private int timeout = 2000;
    
    /**
     * å¯†ç 
     */
    private String password;
    
    /**
     * æ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤0ï¼‰
     */
    private int database = 0;
    
    // Getterå’ŒSetteræ–¹æ³•
    public String getHost() {
        return host;
    }
    
    public void setHost(String host) {
        this.host = host;
    }
    
    public int getPort() {
        return port;
    }
    
    public void setPort(int port) {
        this.port = port;
    }
    
    public int getTimeout() {
        return timeout;
    }
    
    public void setTimeout(int timeout) {
        this.timeout = timeout;
    }
    
    public String getPassword() {
        return password;
    }
    
    public void setPassword(String password) {
        this.password = password;
    }
    
    public int getDatabase() {
        return database;
    }
    
    public void setDatabase(int database) {
        this.database = database;
    }
}
```

**è¯´æ˜**ï¼š
- `@ConfigurationProperties(prefix = "my.redis")`ï¼šç»‘å®š`application.properties`ä¸­ä»¥`my.redis`å¼€å¤´çš„å±æ€§
- æä¾›é»˜è®¤å€¼ï¼šå¦‚`host = "localhost"`ã€`port = 6379`
- æä¾›å®Œæ•´çš„Getterå’ŒSetteræ–¹æ³•

#### æ­¥éª¤2ï¼šåˆ›å»ºè‡ªåŠ¨é…ç½®ç±»

```java
package org.example.autoconfigure.redis;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

/**
 * è‡ªå®šä¹‰Redisè‡ªåŠ¨é…ç½®ç±»
 */
@Configuration  // æ ‡è¯†è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»
@ConditionalOnClass(name = "redis.clients.jedis.Jedis")  // å½“classpathä¸­å­˜åœ¨Jedisç±»æ—¶æ‰ç”Ÿæ•ˆ
@EnableConfigurationProperties(MyRedisProperties.class)  // å¯ç”¨é…ç½®å±æ€§ç»‘å®š
@ConditionalOnProperty(prefix = "my.redis", name = "enabled", havingValue = "true", matchIfMissing = true)
public class MyRedisAutoConfiguration {
    
    private static final Logger logger = LoggerFactory.getLogger(MyRedisAutoConfiguration.class);
    
    /**
     * é…ç½®å±æ€§
     */
    private final MyRedisProperties properties;
    
    /**
     * é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥é…ç½®å±æ€§
     */
    public MyRedisAutoConfiguration(MyRedisProperties properties) {
        this.properties = properties;
        logger.info("MyRedisAutoConfigurationåˆå§‹åŒ–ï¼Œhost: {}, port: {}", 
                    properties.getHost(), properties.getPort());
    }
    
    /**
     * åˆ›å»ºRedisæ“ä½œæ¨¡æ¿Bean
     * åªæœ‰å½“å®¹å™¨ä¸­ä¸å­˜åœ¨MyRedisTemplateç±»å‹çš„Beanæ—¶æ‰ä¼šåˆ›å»º
     */
    @Bean
    @ConditionalOnMissingBean(MyRedisTemplate.class)
    public MyRedisTemplate myRedisTemplate() {
        logger.info("åˆ›å»ºMyRedisTemplate Bean");
        MyRedisTemplate template = new MyRedisTemplate();
        template.setHost(properties.getHost());
        template.setPort(properties.getPort());
        template.setTimeout(properties.getTimeout());
        template.setPassword(properties.getPassword());
        template.setDatabase(properties.getDatabase());
        return template;
    }
}
```

é‰´äºæ­¤æ–‡ä»¶å¯èƒ½ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºMyRedisTemplateç±»ï¼š

```java
package org.example.autoconfigure.redis;

/**
 * è‡ªå®šä¹‰Redisæ“ä½œæ¨¡æ¿
 * è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç¤ºä¾‹ç±»
 */
public class MyRedisTemplate {
    
    private String host;
    private int port;
    private int timeout;
    private String password;
    private int database;
    
    // Getterå’ŒSetteræ–¹æ³•
    public String getHost() {
        return host;
    }
    
    public void setHost(String host) {
        this.host = host;
    }
    
    public int getPort() {
        return port;
    }
    
    public void setPort(int port) {
        this.port = port;
    }
    
    public int getTimeout() {
        return timeout;
    }
    
    public void setTimeout(int timeout) {
        this.timeout = timeout;
    }
    
    public String getPassword() {
        return password;
    }
    
    public void setPassword(String password) {
        this.password = password;
    }
    
    public int getDatabase() {
        return database;
    }
    
    public void setDatabase(int database) {
        this.database = database;
    }
    
    @Override
    public String toString() {
        return "MyRedisTemplate{" +
                "host='" + host + '\'' +
                ", port=" + port +
                ", timeout=" + timeout +
                ", database=" + database +
                '}';
    }
}
```

#### æ­¥éª¤3ï¼šæ³¨å†Œè‡ªåŠ¨é…ç½®ç±»

åœ¨`src/main/resources/META-INF/`ç›®å½•ä¸‹åˆ›å»º`spring.factories`æ–‡ä»¶ï¼š

```properties
# Auto Configure
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.example.autoconfigure.redis.MyRedisAutoConfiguration
```

**æ³¨æ„**ï¼š
- æ–‡ä»¶è·¯å¾„å¿…é¡»å‡†ç¡®ï¼š`META-INF/spring.factories`
- ä½¿ç”¨åæ–œæ `\`å¯ä»¥æ¢è¡Œï¼Œæé«˜å¯è¯»æ€§
- å¤šä¸ªè‡ªåŠ¨é…ç½®ç±»ç”¨é€—å·åˆ†éš”æˆ–æ¯è¡Œä¸€ä¸ª

#### æ­¥éª¤4ï¼šé…ç½®æ–‡ä»¶

åœ¨`application.properties`ä¸­æ·»åŠ é…ç½®ï¼š

```properties
# å¯ç”¨è‡ªå®šä¹‰Redisè‡ªåŠ¨é…ç½®
my.redis.enabled=true
my.redis.host=127.0.0.1
my.redis.port=6379
my.redis.timeout=3000
my.redis.password=123456
my.redis.database=0
```

#### æ­¥éª¤5ï¼šä½¿ç”¨è‡ªåŠ¨é…ç½®

åœ¨Serviceæˆ–Controllerä¸­ç›´æ¥æ³¨å…¥ä½¿ç”¨ï¼š

```java
package org.example.service;

import org.example.autoconfigure.redis.MyRedisTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class RedisService {
    
    @Autowired
    private MyRedisTemplate myRedisTemplate;
    
    public void testRedis() {
        System.out.println("Redisé…ç½®: " + myRedisTemplate);
    }
}
```

### ğŸ¨ å®Œæ•´ä»£ç ç¤ºä¾‹æ€»ç»“

```
src/main/java/org/example/autoconfigure/redis/
â”œâ”€â”€ MyRedisProperties.java        # é…ç½®å±æ€§ç±»
â”œâ”€â”€ MyRedisTemplate.java          # Redisæ“ä½œæ¨¡æ¿
â””â”€â”€ MyRedisAutoConfiguration.java # è‡ªåŠ¨é…ç½®ç±»

src/main/resources/
â”œâ”€â”€ META-INF/
â”‚   â””â”€â”€ spring.factories          # è‡ªåŠ¨é…ç½®æ³¨å†Œæ–‡ä»¶
â””â”€â”€ application.properties        # é…ç½®æ–‡ä»¶
```

---

## 4.5 Conditionæ¡ä»¶æ³¨è§£çš„ä½¿ç”¨

### ğŸ¯ ä»€ä¹ˆæ˜¯Conditionï¼Ÿ

Conditionæ˜¯Spring Bootè‡ªåŠ¨é…ç½®çš„æ¡ä»¶åˆ¤æ–­æœºåˆ¶ã€‚å®ƒå…è®¸æˆ‘ä»¬æ ¹æ®ç‰¹å®šæ¡ä»¶å†³å®šæ˜¯å¦åŠ è½½æŸä¸ªBeanæˆ–é…ç½®ç±»ã€‚

### ğŸ’¡ ç”Ÿæ´»ä¸­çš„æ¯”å–»

æƒ³è±¡ä½ åœ¨åšèœï¼š
- **@ConditionalOnClass**ï¼šåªæœ‰å½“ä½ æœ‰äº†é”…ï¼Œæ‰å‡†å¤‡åšèœçš„ææ–™
- **@ConditionalOnProperty**ï¼šåªæœ‰å½“ä½ è¯´"æˆ‘è¦åšè¾£çš„"ï¼Œæ‰æ”¾è¾£æ¤’
- **@ConditionalOnMissingBean**ï¼šå¦‚æœä½ è¿˜æ²¡å‡†å¤‡ç›˜å­ï¼Œæˆ‘å°±å¸®ä½ å‡†å¤‡ä¸€ä¸ª

### ğŸ“‹ å¸¸ç”¨Conditionæ³¨è§£è¯¦è§£

#### 1. @ConditionalOnClass

**ä½œç”¨**ï¼šå½“classpathä¸­å­˜åœ¨æŒ‡å®šçš„ç±»æ—¶æ‰ç”Ÿæ•ˆã€‚

```java
@Configuration
@ConditionalOnClass(name = "org.springframework.data.redis.core.RedisTemplate")
public class RedisAutoConfiguration {
    // åªæœ‰å½“RedisTemplateç±»å­˜åœ¨æ—¶ï¼Œè¿™ä¸ªé…ç½®ç±»æ‰ä¼šè¢«åŠ è½½
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ£€æŸ¥æŸä¸ªä¾èµ–æ˜¯å¦è¢«å¼•å…¥
- ç¡®ä¿ä¾èµ–çš„ç±»å¯ç”¨

**ç¤ºä¾‹**ï¼š

```java
@Configuration
@ConditionalOnClass({Jedis.class, RedisOperations.class})
public class MyRedisAutoConfiguration {
    // åªæœ‰å½“classpathä¸­åŒæ—¶å­˜åœ¨Jediså’ŒRedisOperationsç±»æ—¶æ‰ç”Ÿæ•ˆ
}
```

#### 2. @ConditionalOnMissingClass

**ä½œç”¨**ï¼šå½“classpathä¸­ä¸å­˜åœ¨æŒ‡å®šçš„ç±»æ—¶æ‰ç”Ÿæ•ˆã€‚

```java
@Configuration
@ConditionalOnMissingClass("org.springframework.data.redis.core.RedisTemplate")
public class SimpleRedisAutoConfiguration {
    // åªæœ‰å½“RedisTemplateç±»ä¸å­˜åœ¨æ—¶ï¼Œè¿™ä¸ªé…ç½®ç±»æ‰ä¼šè¢«åŠ è½½
}
```

#### 3. @ConditionalOnBean

**ä½œç”¨**ï¼šå½“Springå®¹å™¨ä¸­å­˜åœ¨æŒ‡å®šçš„Beanæ—¶æ‰ç”Ÿæ•ˆã€‚

```java
@Configuration
public class MyConfiguration {
    
    @Bean
    @ConditionalOnBean(DataSource.class)
    public JdbcTemplate jdbcTemplate(DataSource dataSource) {
        // åªæœ‰å½“DataSource Beanå­˜åœ¨æ—¶ï¼Œæ‰åˆ›å»ºJdbcTemplate
        return new JdbcTemplate(dataSourceçº¦);
    }
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- å½“æŸä¸ªBeanå­˜åœ¨æ—¶æ‰åˆ›å»ºä¾èµ–å®ƒçš„Bean
- ç¡®ä¿ä¾èµ–çš„Beanå·²ç»å‡†å¤‡å¥½

#### 4. @ConditionalOnMissingBean

**ä½œç”¨**ï¼šå½“Springå®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šçš„Beanæ—¶æ‰ç”Ÿæ•ˆã€‚

```java
@Configuration
public class RedisAutoConfiguration {
    
    @Bean
    @ConditionalOnMissingBean(RedisTemplate.class)
    public RedisTemplate<String, Object> redisTemplate() {
        // åªæœ‰å½“RedisTemplate Beanä¸å­˜åœ¨æ—¶ï¼Œæ‰åˆ›å»ºé»˜è®¤çš„RedisTemplate
        return new RedisTemplate<>();
    }
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- **æä¾›é»˜è®¤é…ç½®**ï¼šå¦‚æœç”¨æˆ·æ²¡æœ‰è‡ªå®šä¹‰ï¼Œå°±ä½¿ç”¨è‡ªåŠ¨é…ç½®çš„é»˜è®¤Bean
- **é¿å…é‡å¤åˆ›å»º**ï¼šé˜²æ­¢é‡å¤åˆ›å»ºç›¸åŒç±»å‹çš„Bean

**é‡è¦**ï¼šè¿™æ˜¯è‡ªåŠ¨é…ç½®ä¸­æœ€å¸¸ç”¨çš„Conditionæ³¨è§£ï¼

#### 5. @ConditionalOnProperty

**ä½œç”¨**ï¼šæ ¹æ®é…ç½®å±æ€§çš„å€¼æ¥å†³å®šæ˜¯å¦ç”Ÿæ•ˆã€‚

```java
@Configuration
@ConditionalOnProperty(
    prefix = "spring.redis",      // é…ç½®å‰ç¼€
    name = "enabled",              // é…ç½®å±æ€§å
    havingValue = "true",          // æœŸæœ›çš„å€¼
    matchIfMissing = true          // å¦‚æœé…ç½®ä¸å­˜åœ¨ï¼Œæ˜¯å¦åŒ¹é…ï¼ˆé»˜è®¤falseï¼‰
)
public class RedisAutoConfiguration {
    // åªæœ‰å½“spring.redis.enabled=trueæ—¶ï¼Œè¿™ä¸ªé…ç½®ç±»æ‰ä¼šç”Ÿæ•ˆ
    // å¦‚æœé…ç½®ä¸å­˜åœ¨ï¼Œé»˜è®¤ä¹Ÿç”Ÿæ•ˆï¼ˆå› ä¸ºmatchIfMissing=trueï¼‰
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- **åŠŸèƒ½å¼€å…³**ï¼šå…è®¸ç”¨æˆ·é€šè¿‡é…ç½®å¯ç”¨æˆ–ç¦ç”¨æŸä¸ªåŠŸèƒ½
- **ç¯å¢ƒé€‚é…**ï¼šæ ¹æ®ä¸åŒçš„ç¯å¢ƒé…ç½®åŠ è½½ä¸åŒçš„ç»„ä»¶

**å®Œæ•´ç¤ºä¾‹**ï¼š

```java
@Configuration
@ConditionalOnProperty(
    prefix = "my.feature",
    name = "cache.enabled",
    havingValue = "true",
    matchIfMissing = false  // é…ç½®ä¸å­˜åœ¨æ—¶ä¸ç”Ÿæ•ˆ
)
public class CacheAutoConfiguration {
    // åªæœ‰å½“my.feature.cache.enabled=trueæ—¶æ‰ç”Ÿæ•ˆ
}
```

å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼š

```properties
# å¯ç”¨ç¼“å­˜åŠŸèƒ½
my.feature.cache.enabled=true
```

#### 6. @ConditionalOnExpression

**ä½œç”¨**ï¼šä½¿ç”¨SpELè¡¨è¾¾å¼æ¥åˆ¤æ–­æ˜¯å¦ç”Ÿæ•ˆã€‚

```java
@Configuration
@ConditionalOnExpression(
    "'${spring.profiles.active}' == 'dev' || '${spring.profiles.active}' == 'test'"
)
public class DevAutoConfiguration {
    // åªæœ‰å½“æ¿€æ´»çš„profileæ˜¯devæˆ–testæ—¶æ‰ç”Ÿæ•ˆ
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- **å¤æ‚æ¡ä»¶åˆ¤æ–­**ï¼šå½“ç®€å•çš„æ¡ä»¶æ³¨è§£æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶
- **å¤šæ¡ä»¶ç»„åˆ**ï¼šä½¿ç”¨é€»è¾‘è¿ç®—ç¬¦ç»„åˆå¤šä¸ªæ¡ä»¶

**SpELè¡¨è¾¾å¼ç¤ºä¾‹**ï¼š

```java
// æ¡ä»¶1ï¼šç«¯å£å·å¤§äº8000
@ConditionalOnExpression("${server.port} > 8000")

// æ¡ä»¶2ï¼šå¤šä¸ªé…ç½®å±æ€§çš„ç»„åˆ
@ConditionalOnExpression(
    "${app.feature.enabled:false} && ${app.feature.type:simple} == 'advanced'"
)

// æ¡ä»¶3ï¼šæ£€æŸ¥Beanæ˜¯å¦å­˜åœ¨
@ConditionalOnExpression("@dataSource != null")
```

#### 7. @ConditionalOnWebApplication

**ä½œç”¨**ï¼šå½“åº”ç”¨æ˜¯Webåº”ç”¨æ—¶æ‰ç”Ÿæ•ˆã€‚

```java
@Configuration
@ConditionalOnWebApplication(type = ConditionalOnWebApplication.Type.SERVLET)
public class WebAutoConfiguration {
    // åªæœ‰å½“åº”ç”¨æ˜¯Servlet Webåº”ç”¨æ—¶æ‰ç”Ÿæ•ˆ
}
```

**ç±»å‹**ï¼š
- `Type.SERVLET`ï¼šServlet Webåº”ç”¨ï¼ˆå¦‚Spring MVCï¼‰
- `Type.REACTIVE`ï¼šå“åº”å¼Webåº”ç”¨ï¼ˆå¦‚WebFluxï¼‰
- `Type.ANY`ï¼šä»»ä½•ç±»å‹çš„Webåº”ç”¨

#### 8. @ConditionalOnNotWebApplication

**ä½œç”¨**ï¼šå½“åº”ç”¨ä¸æ˜¯Webåº”ç”¨æ—¶æ‰ç”Ÿæ•ˆã€‚

```java
@Configuration
@ConditionalOnNotWebApplication
public class ConsoleAutoConfiguration {
    // åªæœ‰å½“åº”ç”¨ä¸æ˜¯Webåº”ç”¨æ—¶æ‰ç”Ÿæ•ˆ
}
```

### ğŸ¯ æ¡ä»¶æ³¨è§£ç»„åˆä½¿ç”¨

å¤šä¸ªæ¡ä»¶æ³¨è§£å¯ä»¥åŒæ—¶ä½¿ç”¨ï¼Œå®ƒä»¬æ˜¯**ANDï¼ˆä¸ï¼‰**çš„å…³ç³»ï¼š

```java
@Configuration
@ConditionalOnClass({RedisOperations.class})
@ConditionalOnProperty(prefix = "spring.redis", name = "enabled", havingValue = "true", matchIfMissing = true)
@ConditionalOnMissingBean(RedisTemplate.class)
public class RedisAutoConfiguration {
    // Storeæ»¡è¶³ä»¥ä¸‹æ‰€æœ‰æ¡ä»¶æ‰ç”Ÿæ•ˆï¼š
    // 1. classpathä¸­å­˜åœ¨RedisOperationsç±»
    // 2. spring.redis.enabled=trueï¼ˆæˆ–é…ç½®ä¸å­˜åœ¨ï¼‰
    // 3. å®¹å™¨ä¸­ä¸å­˜åœ¨RedisTemplate Bean
}
```

### ğŸ“Š æ¡ä»¶æ³¨è§£å¯¹æ¯”è¡¨

| æ³¨è§£ | æ£€æŸ¥å¯¹è±¡ | æ¡ä»¶ | å¸¸ç”¨åœºæ™¯ |
|------|---------|------|----------|
| `@ConditionalOnClass` | Classpath | ç±»å­˜åœ¨ | ä¾èµ–æ£€æŸ¥ |
| `@ConditionalOnMissingClass` | Classpath | ç±»ä¸å­˜åœ¨ | é¿å…å†²çª |
| `@ConditionalOnBean` | Springå®¹å™¨ | Beanå­˜åœ¨ | ä¾èµ–æ³¨å…¥æ£€æŸ¥ |
| `@ConditionalOnMissingBean` | Springå®¹å™¨ | Beanä¸å­˜åœ¨ | æä¾›é»˜è®¤Bean |
| `@ConditionalOnProperty` | é…ç½®æ–‡ä»¶ | å±æ€§å€¼åŒ¹é… | åŠŸèƒ½å¼€å…³ |
| `@ConditionalOnExpression` | SpELè¡¨è¾¾å¼ | è¡¨è¾¾å¼ä¸ºtrue | å¤æ‚æ¡ä»¶ |
| `@ConditionalOnWebApplication` | åº”ç”¨ç±»å‹ | æ˜¯Webåº”ç”¨ | Webç›¸å…³é…ç½® |
| `@ConditionalOnNotWebApplication` | åº”ç”¨ç±»å‹ | ä¸æ˜¯Webåº”ç”¨ | éWebé…ç½® |

### ğŸ’» å®æˆ˜æ¡ˆä¾‹ï¼šå¤šç¯å¢ƒæ¡ä»¶é…ç½®

åˆ›å»ºä¸€ä¸ªæ ¹æ®ç¯å¢ƒè‡ªåŠ¨é€‰æ‹©æ•°æ®æºçš„é…ç½®ï¼š

```java
package org.example.autoconfigure.datasource;

import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.sql.DataSource;

/**
 * æ•°æ®æºè‡ªåŠ¨é…ç½®ç±»
 */
@Configuration
@ConditionalOnClass(DataSource.class)
@EnableConfigurationProperties(DataSourceProperties.class)
public class DataSourceAutoConfiguration {
    
    /**
     * å¼€å‘ç¯å¢ƒæ•°æ®æºï¼ˆå†…å­˜æ•°æ®åº“H2ï¼‰
     */
    @Configuration
    @ConditionalOnProperty(
        prefix = "spring.profiles.active",
        havingValue = "dev"
    )
    static class DevDataSourceConfiguration {
        
        @Bean
        public DataSource devDataSource(DataSourceProperties properties) {
            // è¿”å›H2å†…å­˜æ•°æ®åº“
            return createH2DataSource(properties);
        }
    }
    
    /**
     * ç”Ÿäº§ç¯å¢ƒæ•°æ®æºï¼ˆMySQLï¼‰
     */
    @Configuration
    @ConditionalOnProperty(
        prefix = "spring.profiles.active",
        havingValue = "prod"
    )
    static class ProdDataSourceConfiguration {
        
        @Bean
        public DataSource prodDataSource(DataSourceProperties properties) {
            // è¿”å›MySQLæ•°æ®åº“è¿æ¥
            return createMySQLDataSource(properties);
        }
    }
    
    // è¾…åŠ©æ–¹æ³•
    private static DataSource createH2DataSource(DataSourceProperties properties) {
        // åˆ›å»ºH2æ•°æ®æºçš„å®ç°
        return null;  // ç®€åŒ–ç¤ºä¾‹
    }
    
    private static DataSource createMySQLDataSource(DataSourceProperties properties) {
        // åˆ›å»ºMySQLæ•°æ®æºçš„å®ç°
        return null;  // ç®€åŒ–ç¤ºä¾‹
    }
}
```

---

## 4.6 è‡ªå®šä¹‰ Starter å®ç°

### ğŸ§© å‘½åä¸æ¨¡å—åˆ’åˆ†
- å»ºè®®æ‹†åˆ†ä¸ºä¸¤ä¸ª Maven æ¨¡å—ï¼š
  - `yourlib-spring-boot-autoconfigure`ï¼šæ”¾è‡ªåŠ¨é…ç½®ä¸å±æ€§ç±»
  - `yourlib-spring-boot-starter`ï¼šä»…å£°æ˜ä¾èµ–ï¼ˆä¾èµ–ä¸Šé¢çš„ autoconfigure æ¨¡å—å’Œå¿…è¦ä¸‰æ–¹åº“ï¼‰

### ğŸ“¦ starter æ¨¡å—ï¼ˆä»…ä¾èµ–èšåˆï¼‰

```xml
<!-- yourlib-spring-boot-starter/pom.xml -->
<dependencies>
    <dependency>
        <groupId>com.example</groupId>
        <artifactId>yourlib-spring-boot-autoconfigure</artifactId>
        <version>${project.version}</version>
    </dependency>
    <!-- ä¸‰æ–¹ä¾èµ–ï¼Œå¦‚éœ€è¦ -->
</dependencies>
```

### ğŸ§  autoconfigure æ¨¡å—
1) é…ç½®å±æ€§ç±»

```java
@ConfigurationProperties(prefix = "yourlib")
public class YourLibProperties {
    private boolean enabled = true;
    private String endpoint;
    // getter/setter
}
```

2) è‡ªåŠ¨é…ç½®ç±»

```java
@Configuration(proxyBeanMethods = false)
@EnableConfigurationProperties(YourLibProperties.class)
@ConditionalOnProperty(prefix = "yourlib", name = "enabled", havingValue = "true", matchIfMissing = true)
public class YourLibAutoConfiguration {
    @Bean
    @ConditionalOnMissingBean
    public YourLibClient yourLibClient(YourLibProperties props) {
        return new YourLibClient(props.getEndpoint());
    }
}
```

3) æ³¨å†Œè‡ªåŠ¨é…ç½®ï¼ˆå…³é”®ï¼‰

åœ¨ `yourlib-spring-boot-autoconfigure` æ¨¡å—çš„ `src/main/resources/META-INF/spring.factories`ï¼š

```properties
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
com.example.yourlib.autoconfig.YourLibAutoConfiguration
```

### âœ… ä½¿ç”¨è€…å¦‚ä½•æ¥å…¥

åªéœ€åœ¨ä¸šåŠ¡é¡¹ç›®åŠ å…¥ï¼š

```xml
<dependency>
    <groupId>com.example</groupId>
    <artifactId>yourlib-spring-boot-starter</artifactId>
    <version>x.y.z</version>
</dependency>
```

å¹¶åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼ˆå¯é€‰ï¼‰ï¼š

```properties
yourlib.enabled=true
yourlib.endpoint=https://api.example.com
```

### ğŸ† å®æˆ˜å»ºè®®
- æä¾›åˆç†é»˜è®¤å€¼ + `@ConditionalOnMissingBean`ï¼Œä¾¿äºè¦†ç›–
- åªåœ¨ autoconfigure æ¨¡å—é‡Œæ”¾è‡ªåŠ¨é…ç½®å’Œå±æ€§ç±»ï¼Œé¿å…å¾ªç¯ä¾èµ–
- åœ¨ README ä¸­å†™æ¸…æ¥šâ€œå¼€å…³é…ç½®ã€é»˜è®¤è¡Œä¸ºã€å¦‚ä½•è¦†ç›–â€çš„ä½¿ç”¨è¯´æ˜

---

## 4.7 åŠ¨æ€åŠ è½½é…ç½®

### ğŸ¯ ä»€ä¹ˆæ˜¯åŠ¨æ€åŠ è½½ï¼Ÿ

åŠ¨æ€åŠ è½½æ˜¯æŒ‡åœ¨è¿è¡Œæ—¶ä¿®æ”¹é…ç½®ï¼Œè€Œæ— éœ€é‡å¯åº”ç”¨ç¨‹åºã€‚Spring Bootæä¾›äº†å¤šç§æ–¹å¼æ¥å®ç°é…ç½®çš„åŠ¨æ€åŠ è½½å’Œåˆ·æ–°ã€‚

### ğŸ“‹ åŠ¨æ€åŠ è½½çš„å‡ ç§æ–¹å¼

#### 1. ä½¿ç”¨@RefreshScopeï¼ˆSpring Cloudï¼‰

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯Spring Cloudï¼Œå¯ä»¥ä½¿ç”¨`@RefreshScope`æ³¨è§£ï¼š

**æ·»åŠ ä¾èµ–**ï¼š

```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-config</artifactId>
</dependency>
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```java
@Component
@RefreshScope  // æ·»åŠ æ­¤æ³¨è§£
@ConfigurationProperties(prefix = "my.redis")
public class MyRedisProperties {
    private String host = "localhost";
    private int port = 6379;
    
    // Getterå’ŒSetter
    public String getHost() {
        return host;
    }
    
    public void setHost(Stringç»¤ host) {
        this.host = host;
    }
    
    public int getPort() {
        return port;
    }
    
    public void setPort(int port) {
        this.port = port;
    }
}
```

**è§¦å‘åˆ·æ–°**ï¼š

```bash
# è°ƒç”¨åˆ·æ–°ç«¯ç‚¹
curl -X POST http://localhost:8080/actuator/refresh
```

#### 2. ä½¿ç”¨Environmentå’Œ@Value

é€šè¿‡`Environment`æ¥å£å¯ä»¥åŠ¨æ€è¯»å–é…ç½®ï¼š

```java
@Service
public class ConfigService {
    
    @Autowired
    private Environment environment;
    
    public String getProperty(String key) {
        return environment.getProperty(key);
    }
    
    public void updateProperty(String key, String value) {
        // æ³¨æ„ï¼šè¿™ç§æ–¹å¼åªèƒ½è¯»å–ï¼Œä¸èƒ½ç›´æ¥æ›´æ–°
        // éœ€è¦ä½¿ç”¨é…ç½®ä¸­å¿ƒï¼ˆå¦‚Nacosã€Apolloï¼‰æ¥å®ç°åŠ¨æ€æ›´æ–°
    }
}
```

#### 3. ä½¿ç”¨@ConfigurationPropertieså’ŒEnvironmentChangeEvent

åˆ›å»ºé…ç½®ç›‘å¬å™¨ï¼š

```java
@Component
public class ConfigurationChangeListener {
    
    private static final Logger logger = LoggerFactory.getLogger(ConfigurationChangeListener.class);
    
    @Autowired
    private MyRedisProperties redisProperties;
    
    @EventListener
    public void handleEnvironmentChange(EnvironmentChangeEvent event) {
        logger.info("é…ç½®å‘ç”Ÿå˜åŒ–: {}", event.getKeys());
        // é‡æ–°åŠ è½½é…ç½®
        // æ³¨æ„ï¼šè¿™éœ€è¦é…åˆé…ç½®ä¸­å¿ƒä½¿ç”¨
    }
}
```

### ğŸ”„ å®Œæ•´çš„åŠ¨æ€åŠ è½½ç¤ºä¾‹

åˆ›å»ºä¸€ä¸ªå¯ä»¥åŠ¨æ€æ›´æ–°çš„é…ç½®ç®¡ç†æœåŠ¡ï¼š

```java
package org.example.service;

import org.example.autoconfigure.redis.MyRedisProperties;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.cloud.context.environment.EnvironmentChangeEvent;
import org.springframework.cloud.context.refresh.ContextRefresher;
import org.springframework.context.event.EventListener;
import org.springframework.core.env.ConfigurableEnvironment;
import org.springframework.core.env.MapPropertySource;
import org.springframework.stereotype.Service;

import java.util.HashMap;
import java.util.Map;

/**
 * åŠ¨æ€é…ç½®ç®¡ç†æœåŠ¡
 */
@Service
public class DynamicConfigService {
    
    private static final Logger logger = LoggerFactory.getLogger(DynamicConfigService.class);
    
    @Autowired
    private ConfigurableEnvironment environment;
    
    @Autowired(required = false)
    private ContextRefresher contextRefresher;
    
    @Autowired
    private MyRedisProperties redisProperties;
    
    /**
     * åŠ¨æ€æ›´æ–°é…ç½®å±æ€§
     */
    public void updateProperty(String key, String value) {
        logger.info("æ›´æ–°é…ç½®: {} = {}", key, value);
        
        // è·å–å½“å‰ç¯å¢ƒçš„æ‰€æœ‰å±æ€§æº
        Map<String, Object> source = new HashMap<>();
        source.put(key, value);
        
        // åˆ›å»ºæ–°çš„å±æ€§æº
        MapPropertySource propertySource = new MapPropertySource("dynamic", source);
        
        // æ³¨æ„ï¼šè¿™ç§æ–¹å¼åªèƒ½ä¸´æ—¶æ›´æ–°ï¼Œé‡å¯åä¼šä¸¢å¤±
        // è¦å®ç°çœŸæ­£çš„åŠ¨æ€æ›´æ–°ï¼Œéœ€è¦ä½¿ç”¨é…ç½®ä¸­å¿ƒï¼ˆNacosã€Apolloç­‰ï¼‰
    }
    
    /**
     * ç›‘å¬é…ç½®å˜åŒ–äº‹ä»¶
     */
    @EventListener
    public void handleEnvironmentChange(EnvironmentChangeEvent event) {
        logger.info("æ£€æµ‹åˆ°é…ç½®å˜åŒ–ï¼Œå˜åŒ–çš„Key: {}", event.getKeys());
        
        // é‡æ–°è¯»å–é…ç½®
        String host = environment.getProperty("my.redis.host");
        logger.info("Redis Hostå·²æ›´æ–°ä¸º: {}", host);
        logger.info("å½“å‰RedisProperties: {}", redisProperties.getHost());
    }
    
    /**
     * æ‰‹åŠ¨åˆ·æ–°é…ç½®
     */
    public void refreshConfig() {
        if (contextRefresher != null) {
            logger.info("æ‰‹åŠ¨åˆ·æ–°é…ç½®...");
            contextRefresher.refresh();
        }
    }
}
```

**æ³¨æ„**ï¼šçœŸæ­£çš„åŠ¨æ€é…ç½®æ›´æ–°éœ€è¦ä½¿ç”¨é…ç½®ä¸­å¿ƒï¼Œå¦‚ï¼š
- **Nacos**ï¼šé˜¿é‡Œå·´å·´å¼€æºçš„é…ç½®ä¸­å¿ƒ
- **Apollo**ï¼šæºç¨‹å¼€æºçš„é…ç½®ä¸­å¿ƒ
- **Spring Cloud Config**ï¼šSpringå®˜æ–¹é…ç½®ä¸­å¿ƒ

### ğŸ“Š åŠ¨æ€åŠ è½½æ–¹å¼å¯¹æ¯”

| æ–¹å¼ | æ˜¯å¦éœ€è¦é‡å¯ | å®ç°éš¾åº¦ | é€‚ç”¨åœºæ™¯ |
|------|------------|---------|----------|
| `@RefreshScope` | âŒ ä¸éœ€è¦ | ğŸŸ¢ ç®€å• | Spring Cloudåº”ç”¨ |
| é…ç½®ä¸­å¿ƒï¼ˆNacos/Apolloï¼‰ | âŒ ä¸éœ€è¦ | ğŸŸ¡ ä¸­ç­‰ | ç”Ÿäº§ç¯å¢ƒæ¨è |
| `Environment`æ¥å£ | âŒ ä¸éœ€è¦ | ğŸŸ¢ ç®€å• | è¯»å–é…ç½® |
| æ‰‹åŠ¨åˆ·æ–°Context | âŒ ä¸éœ€è¦ | ğŸ”´ å¤æ‚ | é«˜çº§åœºæ™¯ |

---

## 4.8 è‡ªåŠ¨é…ç½®æ‰§è¡ŒåŸç†æ—¶åºå›¾

### ğŸ“Š è‡ªåŠ¨é…ç½®æ‰§è¡Œæµç¨‹æ—¶åºå›¾

```mermaid
sequenceDiagram
    participant App as å¯åŠ¨ç±»<br/>@SpringBootApplication
    participant SpringApp as SpringApplication
    participant Context as ApplicationContext
    participant Selector as AutoConfigurationImportSelector
    participant Factories as spring.factories
    participant Config as è‡ªåŠ¨é…ç½®ç±»
    participant Condition as ConditionEvaluator
    participant Bean as Beanæ³¨å†Œ

    App->>SpringApp: run(App.class, args)
    SpringApp->>Context: createApplicationContext()
    Context->>App: æ‰«æ@SpringBootApplication
    App->>Selector: selectImports()<br/>åŠ è½½è‡ªåŠ¨é…ç½®ç±»
    Selector->>Factories: è¯»å–META-INF/spring.factories
    Factories-->>Selector: è¿”å›æ‰€æœ‰è‡ªåŠ¨é…ç½®ç±»åˆ—è¡¨
    
    loop éå†æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»
        Selector->>Config: æ£€æŸ¥é…ç½®ç±»
        Config->>Condition: è¯„ä¼°æ¡ä»¶æ³¨è§£
        Condition->>Condition: @ConditionalOnClassæ£€æŸ¥
        Condition->>Condition: @ConditionalOnBeanæ£€æŸ¥
        Condition->>Condition: @ConditionalOnPropertyæ£€æŸ¥
        alt æ¡ä»¶æ»¡è¶³
            Condition-->>Config: æ¡ä»¶é€šè¿‡
            Config->>Bean: æ³¨å†ŒBeanåˆ°å®¹å™¨
        else æ¡ä»¶ä¸æ»¡è¶³
            Condition-->>Config: æ¡ä»¶ä¸é€šè¿‡
            Config->>Config: è·³è¿‡æ­¤é…ç½®ç±»
        end
    end
    
    Selector-->>Context: è¿”å›éœ€è¦åŠ è½½çš„é…ç½®ç±»
    Context->>Context: å®ä¾‹åŒ–é…ç½®ç±»
    Context->>Bean: åˆ›å»ºBeanå®ä¾‹
    Context-->>SpringApp: å®¹å™¨åˆå§‹åŒ–å®Œæˆ
    SpringApp-->>App: å¯åŠ¨æˆåŠŸ
```

### ğŸ” è¯¦ç»†æ‰§è¡Œæ­¥éª¤è§£æ

#### æ­¥éª¤1ï¼šåº”ç”¨å¯åŠ¨

```java
@SpringBootApplication  // åŒ…å«@EnableAutoConfiguration
public class App {
    public static void main(String[] args) {
        SpringApplication.run(App.class, args);
    }
}
```

**å…³é”®æ³¨è§£**ï¼š`@SpringBootApplication`åŒ…å«äº†`@EnableAutoConfiguration`

#### æ­¥éª¤2ï¼šæ‰«æè‡ªåŠ¨é…ç½®

```java
// @EnableAutoConfigurationçš„å®šä¹‰
@Import(AutoConfigurationImportSelector.class)
public @interface EnableAutoConfiguration {
    // ...
}
```

**å…³é”®ç±»**ï¼š`AutoConfigurationImportSelector`è´Ÿè´£é€‰æ‹©å’ŒåŠ è½½è‡ªåŠ¨é…ç½®ç±»

#### æ­¥éª¤3ï¼šè¯»å–spring.factories

```java
// AutoConfigurationImportSelectorçš„å…³é”®æ–¹æ³•
protected List<String> getCandidateConfigurations(
        AnnotationMetadata metadata, AnnotationAttributes attributes) {
    List<String> configurations = SpringFactoriesLoader.loadFactoryNames(
        getSpringFactoriesLoaderFactoryClass(), getBeanClassLoader());
    return configurations;
}
```

**å…³é”®æ–¹æ³•**ï¼š`SpringFactoriesLoader.loadFactoryNames()`ä»`spring.factories`æ–‡ä»¶ä¸­è¯»å–é…ç½®ç±»åˆ—è¡¨

#### æ­¥éª¤4ï¼šæ¡ä»¶è¯„ä¼°

```java
// OnClassConditionç±»çš„è¯„ä¼°é€»è¾‘
@Override
public ConditionOutcome getMatchOutcome(ConditionContext context,
        AnnotatedTypeMetadata metadata) {
    // æ£€æŸ¥classpathä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„ç±»
    List<String> missing = fallenOnClassNames(metadata, ConditionalOnClass.class);
    if (!missing.isEmpty()) {
        return ConditionOutcome.noMatch(...);
    }
    return ConditionOutcome.match();
}
```

**æ¡ä»¶æ£€æŸ¥é¡ºåº**ï¼š
1. `@ConditionalOnClass`ï¼šæ£€æŸ¥ç±»æ˜¯å¦å­˜åœ¨
2. `@ConditionalOnBean`ï¼šæ£€æŸ¥Beanæ˜¯å¦å­˜åœ¨
3. `@ConditionalOnProperty`ï¼šæ£€æŸ¥é…ç½®å±æ€§
4. å…¶ä»–æ¡ä»¶æ³¨è§£...

#### æ­¥éª¤5ï¼šBeanæ³¨å†Œ

```java
// è‡ªåŠ¨é…ç½®ç±»ä¸­çš„Beanæ–¹æ³•
@Bean
@ConditionalOnMissingBean
public RedisTemplate<String, Object> redisTemplate() {
    return new RedisTemplate<>();
}
```

å¦‚æœæ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³ï¼ŒBeanä¼šè¢«æ³¨å†Œåˆ°Springå®¹å™¨ä¸­ã€‚

### ğŸ“ˆ æ‰§è¡Œæµç¨‹æ–‡å­—è¯´æ˜

1. **å¯åŠ¨é˜¶æ®µ**ï¼š
   - ç”¨æˆ·è°ƒç”¨`SpringApplication.run()`
   - Spring Bootåˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡

2. **æ‰«æé˜¶æ®µ**ï¼š
   - å‘ç°`@EnableAutoConfiguration`æ³¨è§£
   - è§¦å‘`AutoConfigurationImportSelector`æ‰§è¡Œ

3. **åŠ è½½é˜¶æ®µ**ï¼š
   - è¯»å–æ‰€æœ‰jaråŒ…ä¸­çš„`META-INF/spring.factories`æ–‡ä»¶
   - è·å–æ‰€æœ‰`EnableAutoConfiguration`å¯¹åº”çš„é…ç½®ç±»åˆ—è¡¨

4. **è¿‡æ»¤é˜¶æ®µ**ï¼š
   - æ’é™¤ç”¨æˆ·æ˜ç¡®æ’é™¤çš„é…ç½®ç±»ï¼ˆé€šè¿‡`exclude`å±æ€§ï¼‰
   - æ ¹æ®æ¡ä»¶æ³¨è§£è¿‡æ»¤ä¸éœ€è¦çš„é…ç½®ç±»

5. **è¯„ä¼°é˜¶æ®µ**ï¼š
   - å¯¹æ¯ä¸ªé…ç½®ç±»è¿›è¡Œæ¡ä»¶è¯„ä¼°
   - æ£€æŸ¥classpathã€Beanã€é…ç½®å±æ€§ç­‰æ¡ä»¶

6. **æ³¨å†Œé˜¶æ®µ**ï¼š
   - åŠ è½½é€šè¿‡æ¡ä»¶è¯„ä¼°çš„é…ç½®ç±»
   - æ‰§è¡Œé…ç½®ç±»ä¸­çš„`@Bean`æ–¹æ³•
   - å°†Beanæ³¨å†Œåˆ°Springå®¹å™¨

7. **å®Œæˆé˜¶æ®µ**ï¼š
   - æ‰€æœ‰è‡ªåŠ¨é…ç½®å®Œæˆ
   - åº”ç”¨å¯ä»¥æ­£å¸¸ä½¿ç”¨è¿™äº›Bean

### ğŸ” æºç å…³é”®ä½ç½®

å¦‚æœä½ æƒ³æ·±å…¥ç†è§£ï¼Œå¯ä»¥æŸ¥çœ‹ä»¥ä¸‹å…³é”®ç±»ï¼š

```java
// 1. è‡ªåŠ¨é…ç½®é€‰æ‹©å™¨
org.springframework.boot.autoconfigure.AutoConfigurationImportSelector

// 2. æ¡ä»¶è¯„ä¼°å™¨
org.springframework.boot.autoconfigure.condition.OnClassCondition
org.springframework.boot.autoconfigure.condition.OnBeanCondition
org.springframework.boot.autoconfigure.condition.OnPropertyCondition

// 3. é…ç½®ç±»åŠ è½½å™¨
org.springframework.core.io.support.SpringFactoriesLoader

// 4. é…ç½®ç±»å®šä¹‰
org.springframework.boot.autoconfigure.redis.RedisAutoConfiguration
org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
```

### ğŸ› è°ƒè¯•æŠ€å·§

#### 1. å¼€å¯è‡ªåŠ¨é…ç½®æŠ¥å‘Š

åœ¨`application.properties`ä¸­æ·»åŠ ï¼š

```properties
# å¼€å¯è°ƒè¯•æ¨¡å¼ï¼ŒæŸ¥çœ‹è‡ªåŠ¨é…ç½®æŠ¥å‘Š
debug=true
```

å¯åŠ¨åº”ç”¨åï¼Œæ§åˆ¶å°ä¼šè¾“å‡ºè¯¦ç»†çš„è‡ªåŠ¨é…ç½®æŠ¥å‘Šï¼š
- `Positive matches`ï¼šå·²å¯ç”¨çš„è‡ªåŠ¨é…ç½®
- `Negative matches`ï¼šæœªå¯ç”¨çš„è‡ªåŠ¨é…ç½®åŠåŸå› 

#### 2. ä½¿ç”¨@ConditionalOnMissingBeançš„nameå±æ€§

```java
@Bean
@ConditionalOnMissingBean(name = "myCustomBean")
public MyDefaultBean defaultBean() {
    return new MyDefaultBean();
}
```

è¿™æ ·å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°å“ªä¸ªBeanè¢«åˆ›å»ºäº†ã€‚

#### 3. æŸ¥çœ‹å®é™…åŠ è½½çš„é…ç½®ç±»

```java
@SpringBootApplication
public class App {
    public static void main(String[] args) {
        ConfigurableApplicationContext context = SpringApplication.run(App.class, args);
        
        // æŸ¥çœ‹æ‰€æœ‰è‡ªåŠ¨é…ç½®å“¨
        String[] beanNames = context.getBeanNamesForType(Object.class);
        for (String beanName : beanNames) {
            System.out.println("Bean: " + beanName);
        }
    }
}
```

---

## 4.9 ä½¿ç”¨åœºæ™¯å’Œå®è·µ

### ğŸ¯ ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨è‡ªåŠ¨é…ç½®ï¼Ÿ

#### âœ… é€‚åˆä½¿ç”¨è‡ªåŠ¨é…ç½®çš„åœºæ™¯

1. **å¼€å‘å…¬å…±ç»„ä»¶åº“**
   - ä¸ºå…¶ä»–é¡¹ç›®æä¾›å¯å¤ç”¨çš„åŠŸèƒ½
   - å¸Œæœ›æä¾›é»˜è®¤é…ç½®ï¼Œå‡å°‘ä½¿ç”¨è€…çš„é…ç½®å·¥ä½œ

2. **é…ç½®å¤æ‚çš„ç¬¬ä¸‰æ–¹é›†æˆ**
   - é›†æˆRedisã€RabbitMQã€Elasticsearchç­‰ä¸­é—´ä»¶
   - æä¾›åˆç†çš„é»˜è®¤é…ç½®å’Œç®€åŒ–é…ç½®æ–¹å¼

3. **å¤šç¯å¢ƒé€‚é…**
   - å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒæœ‰ä¸åŒçš„é…ç½®
   - é€šè¿‡æ¡ä»¶æ³¨è§£è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„é…ç½®

4. **åŠŸèƒ½å¼€å…³æ§åˆ¶**
   - æŸäº›åŠŸèƒ½å¯ä»¥é€šè¿‡é…ç½®å¼€å…³å¯ç”¨æˆ–ç¦ç”¨
   - ä½¿ç”¨`@ConditionalOnProperty`å®ç°

5. **æä¾›é»˜è®¤å®ç°**
   - å½“ç”¨æˆ·æ²¡æœ‰è‡ªå®šä¹‰æ—¶ï¼Œæä¾›é»˜è®¤çš„Bean
   - å½“ç”¨æˆ·è‡ªå®šä¹‰æ—¶ï¼Œè‡ªåŠ¨ä½¿ç”¨ç”¨æˆ·çš„é…ç½®

#### âŒ ä¸é€‚åˆä½¿ç”¨è‡ªåŠ¨é…ç½®çš„åœºæ™¯

1. **ä¸šåŠ¡é€»è¾‘é…ç½®**
   - ä¸šåŠ¡ç›¸å…³çš„é…ç½®ä¸åº”è¯¥æ”¾åœ¨è‡ªåŠ¨é…ç½®ä¸­
   - åº”è¯¥ä½¿ç”¨æ™®é€šçš„`@Configuration`ç±»

2. **é¡¹ç›®ç‰¹æœ‰çš„é…ç½®**
   - åªåœ¨å½“å‰é¡¹ç›®ä¸­ä½¿ç”¨çš„é…ç½®
   - ä¸éœ€è¦å°è£…æˆè‡ªåŠ¨é…ç½®

3. **ç®€å•çš„ä¸€æ¬¡æ€§é…ç½®**
   - é…ç½®éå¸¸ç®€å•ï¼Œæ²¡å¿…è¦å°è£…æˆè‡ªåŠ¨é…ç½®
   - ç›´æ¥ä½¿ç”¨`@Configuration`å’Œ`@Bean`å³å¯

### ğŸ’¼ å®æˆ˜æ¡ˆä¾‹

#### æ¡ˆä¾‹1ï¼šé‚®ä»¶æœåŠ¡è‡ªåŠ¨é…ç½®

```java
package org.example.autoconfigure.mail;

import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.JavaMailSenderImpl;

/**
 * é‚®ä»¶æœåŠ¡è‡ªåŠ¨é…ç½®
 */
@Configuration
@ConditionalOnClass(JavaMailSender.class)
@EnableConfigurationProperties(MailProperties.class)
@ConditionalOnProperty(prefix = "app.mail", name = "enabled", havingValue = "true", matchIfMissing = true)
public class MailAutoConfiguration {
    
    private final MailProperties properties;
    
    public MailAutoConfiguration(MailProperties properties) {
        this.properties = properties;
    }
    
    @Bean
    @ConditionalOnMissingBean
    public JavaMailSender javaMailSender() {
        JavaMailSenderImpl mailSender = new JavaMailSenderImpl();
        mailSender.setHost(properties.getHost());
        mailSender.setPort(properties.getPort());
        mailSender.setUsername(properties.getUsername());
        mailSender.setPassword(properties.getPassword());
        mailSender.getJavaMailProperties().setProperty("mail.smtp.auth", "true");
        mailSender.getJavaMailProperties().setProperty("mail.smtp.starttls.enable", "true");
        return mailSender;
    }
}
```

**é…ç½®å±æ€§ç±»**ï¼š

```java
@ConfigurationProperties(prefix = "app.mail")
public class MailProperties {
    private String host = "smtp.gmail.com";
    private int port = 587;
    private String username;
    private String password;
    private boolean enabled = true;
    
    // Getterå’ŒSetter...
}
```

**é…ç½®æ–‡ä»¶**ï¼š

```properties
app.mail.enabled=true
app.mail.host=smtp.gmail.com
app.mail.port=587
app.mail.username=your-email@gmail.com
app.mail.password=your-password
```

#### æ¡ˆä¾‹2ï¼šå¤šæ•°æ®æºè‡ªåŠ¨é…ç½®

```java
package org.example.autoconfigure.datasource;

import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Primary;

import javax.sql.DataSource;

/**
 * å¤šæ•°æ®æºè‡ªåŠ¨é…ç½®
 */
@Configuration
@ConditionalOnClass(DataSource.class)
@EnableConfigurationProperties(MultiDataSourceProperties.class)
public class MultiDataSourceAutoConfiguration {
    
    private final MultiDataSourceProperties properties;
    
    public MultiDataSourceAutoConfiguration(MultiDataSourceProperties properties) {
        this.properties = properties;
    }
    
    /**
     * ä¸»æ•°æ®æº
     */
    @Bean
    @Primary
    @ConditionalOnProperty(prefix = "app.datasource.primary", name = "enabled", havingValue = "true")
    public DataSource primaryDataSource() {
        return createDataSource(properties.getPrimary());
    }
    
    /**
     * ä»æ•°æ®æº
     */
    @Bean
    @ConditionalOnProperty(prefix = "app.datasource.secondary", name = "enabled", havingValue = "true")
    public DataSource secondaryDataSource() {
        return createDataSource(properties.getSecondary());
    }
    
    private DataSource createDataSource(DataSourceConfig config) {
        // åˆ›å»ºæ•°æ®æºçš„é€»è¾‘
        return null;  // ç®€åŒ–ç¤ºä¾‹
    }
}
```

### ğŸ“‹ æœ€ä½³å®è·µ

#### 1. æä¾›åˆç†çš„é»˜è®¤å€¼

```java
@ConfigurationProperties(prefix = "app.redis")
public class RedisProperties {
    // âœ… å¥½çš„åšæ³•ï¼šæä¾›é»˜è®¤å€¼
    private String host = "localhost";
    private int port = 6379;
    private int timeout = 2000;
    
    // âŒ ä¸å¥½çš„åšæ³•ï¼šä¸æä¾›é»˜è®¤å€¼ï¼Œè¦æ±‚ç”¨æˆ·å¿…é¡»é…ç½®
    // private String host;  // å¦‚æœæ²¡æœ‰é»˜è®¤å€¼ï¼Œç”¨æˆ·å¿…é¡»é…ç½®
}
```

#### 2. ä½¿ç”¨æ¡ä»¶æ³¨è§£é¿å…å†²çª

```java
@Bean
@ConditionalOnMissingBean(RedisTemplate.class)  // âœ… é¿å…é‡å¤åˆ›å»º
public RedisTemplate<String, Object> redisTemplate() {
    return new RedisTemplate<>();
}
```

#### 3. ä½¿ç”¨é…ç½®å±æ€§ç±»

```java
// âœ… å¥½çš„åšæ³•ï¼šä½¿ç”¨@ConfigurationProperties
@ConfigurationProperties(prefix = "app.redis")
public class RedisProperties {
    // ...
}

// âŒ ä¸å¥½çš„åšæ³•ï¼šç›´æ¥åœ¨é…ç½®ç±»ä¸­ä½¿ç”¨@Value
@Configuration
public class RedisConfig {
    @Value("${app.redis.host}")  // ä¸æ¨è
    private String host;
}
```

#### 4. åˆç†ä½¿ç”¨@ConditionalOnClass

```java
@Configuration
@ConditionalOnClass(RedisOperations.class)  // âœ… æ£€æŸ¥å…³é”®ç±»
public class RedisAutoConfiguration {
    // ...
}
```

#### 5. æä¾›æ¸…æ™°çš„æ–‡æ¡£

åœ¨é…ç½®å±æ€§ç±»ä¸Šæ·»åŠ æ³¨é‡Šï¼š

```java
@ConfigurationProperties(prefix = "app.redis")
public class RedisProperties {
    /**
     * RedisæœåŠ¡å™¨åœ°å€
     */
    private String host = "localhost";
    
    /**
     * RedisæœåŠ¡å™¨ç«¯å£
     */
    private int port = 6379;
    
    /**
     * è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
     */
    private int timeout = 2000;
}
```

---

## 4.10 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### â“ å¸¸è§é—®é¢˜FAQ

#### Q1ï¼šè‡ªåŠ¨é…ç½®æ²¡æœ‰ç”Ÿæ•ˆï¼Ÿ

**ç—‡çŠ¶**ï¼šé…ç½®äº†è‡ªåŠ¨é…ç½®ç±»ï¼Œä½†æ˜¯Beanæ²¡æœ‰è¢«åˆ›å»ºã€‚

**å¯èƒ½åŸå› å’Œè§£å†³æ–¹æ¡ˆ**ï¼š

1. **spring.factoriesæ–‡ä»¶ä½ç½®ä¸å¯¹**
   ```
   âœ… æ­£ç¡®è·¯å¾„ï¼šsrc/main/resources/META-INF/spring.factories
   âŒ é”™è¯¯è·¯å¾„ï¼šsrc/main/java/META-INF/spring.factories
   ```

2. **é…ç½®ç±»æ²¡æœ‰è¢«æ‰«æåˆ°**
   ```java
   // æ£€æŸ¥é…ç½®ç±»ä¸Šæ˜¯å¦æœ‰@Configurationæ³¨è§£
   @Configuration  // âœ… å¿…é¡»æœ‰è¿™ä¸ªæ³¨è§£
   public class MyAutoConfiguration {
       // ...
   }
   ```

3. **æ¡ä»¶æ³¨è§£ä¸æ»¡è¶³**
   ```java
   // æ£€æŸ¥æ¡ä»¶æ³¨è§£æ˜¯å¦æ»¡è¶³
   @ConditionalOnClass(SomeClass.class)  // ç¡®ä¿SomeClassåœ¨classpathä¸­
   @ConditionalOnProperty(prefix = "app.xxx", name = "enabled", havingValue = "true")
   ```

4. **è¢«å…¶ä»–é…ç½®ç±»æ’é™¤äº†**
   ```java
   @SpringBootApplication(exclude = MyAutoConfiguration.class)  // æ£€æŸ¥æ˜¯å¦è¢«æ’é™¤
   ```

**è°ƒè¯•æ–¹æ³•**ï¼š
```properties
# åœ¨application.propertiesä¸­æ·»åŠ 
debug=true
```
å¯åŠ¨åæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°å“ªäº›è‡ªåŠ¨é…ç½®ç”Ÿæ•ˆäº†ï¼Œå“ªäº›æ²¡æœ‰ç”Ÿæ•ˆä»¥åŠåŸå› ã€‚

#### Q2ï¼šè‡ªåŠ¨é…ç½®çš„Beanè¢«è¦†ç›–äº†ï¼Ÿ

**ç—‡çŠ¶**ï¼šè‡ªåŠ¨é…ç½®åˆ›å»ºäº†Beanï¼Œä½†å®é™…ä½¿ç”¨çš„æ˜¯è‡ªå®šä¹‰çš„Beanã€‚

**åŸå› **ï¼šè¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Spring Bootè®¾è®¡å°±æ˜¯è¿™æ ·ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
// å¦‚æœè‡ªåŠ¨é…ç½®ä½¿ç”¨äº†@ConditionalOnMissingBeanï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨ä½ çš„Bean
@Bean
public RedisTemplate<String, Object> myRedisTemplate() {
    // ä½ çš„è‡ªå®šä¹‰å®ç°ä¼šä¼˜å…ˆäºè‡ªåŠ¨é…ç½®
    return new MyCustomRedisTemplate();
}
```

#### Q3ï¼šé…ç½®å±æ€§ç»‘å®šå¤±è´¥ï¼Ÿ

**ç—‡çŠ¶**ï¼šé…ç½®æ–‡ä»¶ä¸­çš„å±æ€§æ²¡æœ‰ç»‘å®šåˆ°é…ç½®å±æ€§ç±»ã€‚

**å¯èƒ½åŸå› **ï¼š

1. **é…ç½®å±æ€§ç±»æ²¡æœ‰ä½¿ç”¨@EnableConfigurationProperties**
   ```java
   @Configuration
   @EnableConfigurationProperties(MyProperties.class)  // âœ… å¿…é¡»æ·»åŠ 
   public class MyAutoConfiguration {
       // ...
   }
   ```

2. **é…ç½®å‰ç¼€ä¸åŒ¹é…**
   ```java
   @ConfigurationProperties(prefix = "app.redis")  // é…ç½®æ–‡ä»¶å¿…é¡»æ˜¯app.redis.*
   public class MyProperties {
       // ...
   }
   ```

3. **Getter/Setteræ–¹æ³•ç¼ºå¤±**
   ```java
   public class MyProperties {
       private String host;
       
       // âœ… å¿…é¡»æä¾›Getterå’ŒSetter
       public String getHost() {
           return host;
       }
       
       public void setHost(String host) {
           this.host = host;
       }
   }
   ```

#### Q4ï¼šå¦‚ä½•æŸ¥çœ‹æ‰€æœ‰è‡ªåŠ¨é…ç½®ç±»ï¼Ÿ

**æ–¹æ³•1ï¼šä½¿ç”¨è°ƒè¯•æ¨¡å¼**
```properties
debug=true
```

**æ–¹æ³•2ï¼šä½¿ç”¨Actuatorç«¯ç‚¹**ï¼ˆéœ€è¦æ·»åŠ ä¾èµ–ï¼‰
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

```properties
management.endpoints.web.exposure.include=*
```

è®¿é—®ï¼š`http://localhost:8080/actuator/conditions`

#### Q5ï¼šå¦‚ä½•æ’é™¤æŸä¸ªè‡ªåŠ¨é…ç½®ï¼Ÿ

**æ–¹æ³•1ï¼šä½¿ç”¨excludeå±æ€§**
```java
@SpringBootApplication(exclude = {RedisAutoConfiguration.class})
public class App {
    // ...
}
```

**æ–¹æ³•2ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶**
```properties
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration
```

**æ–¹æ³•3ï¼šä½¿ç”¨excludeNameå±æ€§**
```java
@SpringBootApplication(excludeName = "org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration")
public class App {
    // ...
}
```

#### Q6ï¼šå¤šä¸ªè‡ªåŠ¨é…ç½®ç±»å†²çªæ€ä¹ˆåŠï¼Ÿ

**ç—‡çŠ¶**ï¼šå¤šä¸ªè‡ªåŠ¨é…ç½®ç±»éƒ½åˆ›å»ºäº†ç›¸åŒç±»å‹çš„Beanã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **ä½¿ç”¨@ConditionalOnMissingBean**
   ```java
   @Bean
   @ConditionalOnMissingBean  // âœ… å¦‚æœå·²å­˜åœ¨ï¼Œå°±ä¸åˆ›å»º
   public MyBean myBean() {
       return new MyBean();
   }
   ```

2. **ä½¿ç”¨@PrimaryæŒ‡å®šä¼˜å…ˆçº§**
   ```java
   @Bean
   @Primary  // âœ… ä¼˜å…ˆä½¿ç”¨è¿™ä¸ªBean
   public MyBean primaryBean() {
       return new MyBean();
   }
   ```

3. **æ’é™¤å†²çªçš„è‡ªåŠ¨é…ç½®**
   ```java
   @SpringBootApplication(exclude = ConflictAutoConfiguration.class)
   ```

#### Q7ï¼šå¦‚ä½•æµ‹è¯•è‡ªåŠ¨é…ç½®ï¼Ÿ

**åˆ›å»ºæµ‹è¯•é…ç½®ç±»**ï¼š
```java
@SpringBootTest
@AutoConfigureMockMvc
class MyAutoConfigurationTest {
    
    @Autowired
    private ApplicationContext context;
    
    @Test
    void testAutoConfigurationLoaded() {
        // æ£€æŸ¥Beanæ˜¯å¦å­˜åœ¨
        assertThat(context.containsBean("myBean")).isTrue();
    }
}
```

#### Q8ï¼šè‡ªåŠ¨é…ç½®çš„æ€§èƒ½å½±å“ï¼Ÿ

**é—®é¢˜**ï¼šè‡ªåŠ¨é…ç½®ä¼šå½±å“å¯åŠ¨é€Ÿåº¦å—ï¼Ÿ

**ç­”æ¡ˆ**ï¼š
- è‡ªåŠ¨é…ç½®ç±»çš„æ¡ä»¶è¯„ä¼°å‘ç”Ÿåœ¨å¯åŠ¨æ—¶
- åªæœ‰æ»¡è¶³æ¡ä»¶çš„é…ç½®ç±»æ‰ä¼šè¢«åŠ è½½
- é€šå¸¸å½±å“å¾ˆå°ï¼ˆæ¯«ç§’çº§ï¼‰
- å¯ä»¥é€šè¿‡æ’é™¤ä¸éœ€è¦çš„è‡ªåŠ¨é…ç½®æ¥ä¼˜åŒ–

### ğŸ› è°ƒè¯•æŠ€å·§æ€»ç»“

#### 1. å¼€å¯è°ƒè¯•æ¨¡å¼
```properties
debug=true
<ï½œplaceâ–holderâ–noâ–112ï½œ>
#### 2. æŸ¥çœ‹Beanå®šä¹‰
```java
@SpringBootApplication
public class App {
    public static void main(String[] args) {
        ConfigurableApplicationContext context = SpringApplication.run(App.class, args);
        String[] beanNames = context.getBeanDefinitionNames();
        Arrays.sort(beanNames);
        for (String beanName : beanNames) {
            System.out.println(beanName);
        }
    }
}
```

#### 3. æ£€æŸ¥æ¡ä»¶è¯„ä¼°ç»“æœ
```properties
# åœ¨æ—¥å¿—é…ç½®ä¸­è®¾ç½®
logging.level.org.springframework.boot.autoconfigure=DEBUG
```

---

## 4.11 æ€»ç»“

### ğŸ“ æ ¸å¿ƒè¦ç‚¹å›é¡¾

#### 1. è‡ªåŠ¨é…ç½®çš„æœ¬è´¨
- **ç›®çš„**ï¼šå‡å°‘é…ç½®å·¥ä½œï¼Œæé«˜å¼€å‘æ•ˆç‡
- **åŸç†**ï¼šæ ¹æ®æ¡ä»¶è‡ªåŠ¨åˆ›å»ºå’Œé…ç½®Bean
- **æ ¸å¿ƒ**ï¼š`@EnableAutoConfiguration`ã€`spring.factories`ã€æ¡ä»¶æ³¨è§£

#### 2. æ¡ä»¶æ³¨è§£çš„ä½œç”¨
- **@ConditionalOnClass**ï¼šæ£€æŸ¥ç±»æ˜¯å¦å­˜åœ¨
- **@ConditionalOnBean**ï¼šæ£€æŸ¥Beanæ˜¯å¦å­˜åœ¨
- **@ConditionalOnProperty**ï¼šæ£€æŸ¥é…ç½®å±æ€§
- **@ConditionalOnMissingBean**ï¼šæä¾›é»˜è®¤Beanï¼ˆæœ€å¸¸ç”¨ï¼‰

#### 3. ç¼–å†™è‡ªåŠ¨é…ç½®çš„æ­¥éª¤
1. åˆ›å»ºé…ç½®å±æ€§ç±»ï¼ˆ`@ConfigurationProperties`ï¼‰
2. åˆ›å»ºè‡ªåŠ¨é…ç½®ç±»ï¼ˆ`@Configuration` + æ¡ä»¶æ³¨è§£ï¼‰
3. æ³¨å†Œåˆ°`spring.factories`
4. æµ‹è¯•éªŒè¯

#### 4. æœ€ä½³å®è·µ
- âœ… æä¾›åˆç†çš„é»˜è®¤å€¼
- âœ… ä½¿ç”¨æ¡ä»¶æ³¨è§£é¿å…å†²çª
- âœ… ä½¿ç”¨é…ç½®å±æ€§ç±»ç»‘å®šé…ç½®
- âœ… æä¾›æ¸…æ™°çš„æ–‡æ¡£å’Œæ³¨é‡Š
- âœ… æ”¯æŒé…ç½®å¼€å…³ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰

### ğŸ¯ å­¦ä¹ è·¯å¾„å»ºè®®

1. **åˆçº§é˜¶æ®µ**ï¼š
   - ç†è§£è‡ªåŠ¨é…ç½®çš„æ¦‚å¿µå’Œä¼˜åŠ¿
   - æŸ¥çœ‹Spring Bootè‡ªå¸¦çš„è‡ªåŠ¨é…ç½®ç±»
   - å­¦ä¹ ä½¿ç”¨æ¡ä»¶æ³¨è§£

2. **ä¸­çº§é˜¶æ®µ**ï¼š
   - ç¼–å†™ç®€å•çš„è‡ªå®šä¹‰è‡ªåŠ¨é…ç½®
   - ç†è§£`spring.factories`çš„ä½œç”¨
   - æŒæ¡å¸¸ç”¨æ¡ä»¶æ³¨è§£çš„ä½¿ç”¨

3. **é«˜çº§é˜¶æ®µ**ï¼š
   - æ·±å…¥ç†è§£è‡ªåŠ¨é…ç½®çš„æ‰§è¡Œæµç¨‹
   - å®ç°å¤æ‚çš„æ¡ä»¶åˆ¤æ–­
   - ä¼˜åŒ–è‡ªåŠ¨é…ç½®çš„æ€§èƒ½

### ğŸ“š å»¶ä¼¸é˜…è¯»

- [Spring Bootå®˜æ–¹æ–‡æ¡£ - Auto-configuration](https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.auto-configuration)
- [Spring Bootæºç åˆ†æ](https://github.com/spring-projects/spring-boot)
- ç›¸å…³æŠ€æœ¯ï¼šSpring Cloud Configã€Nacosã€Apolloé…ç½®ä¸­å¿ƒ

### ğŸ“ ç»ƒä¹ é¢˜

1. **åŸºç¡€ç»ƒä¹ **ï¼š
   - åˆ›å»ºä¸€ä¸ªç®€å•çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œæä¾›æŸä¸ªæœåŠ¡çš„é»˜è®¤Bean
   - ä½¿ç”¨`@ConditionalOnProperty`å®ç°é…ç½®å¼€å…³

2. **è¿›é˜¶ç»ƒä¹ **ï¼š
   - å®ç°å¤šç¯å¢ƒçš„è‡ªåŠ¨é…ç½®ï¼ˆdevã€testã€prodï¼‰
   - åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„ç¬¬ä¸‰æ–¹æœåŠ¡è‡ªåŠ¨é…ç½®ï¼ˆå¦‚çŸ­ä¿¡æœåŠ¡ã€OSSæœåŠ¡ï¼‰

3. **é«˜çº§ç»ƒä¹ **ï¼š
   - åˆ†æSpring Bootä¸­Redisè‡ªåŠ¨é…ç½®çš„å®Œæ•´å®ç°
   - å®ç°é…ç½®çš„åŠ¨æ€åˆ·æ–°æœºåˆ¶

---

> **ä½œè€…**: yangzhao  
> **ç‰ˆæœ¬**: 1.0  
> **æ›´æ–°æ—¶é—´**: 2024å¹´  
> **é¢„è®¡å­¦ä¹ æ—¶é—´**: 60-90åˆ†é’Ÿ  
> **éš¾åº¦ç­‰çº§**: â­â­â­â˜†â˜† (ä¸­çº§)

---

**ä¸‹ä¸€ç« å­¦ä¹ å»ºè®®**ï¼š
- æ·±å…¥å­¦ä¹ Spring Bootçš„å¯åŠ¨åŸç†
- äº†è§£Spring Bootçš„æ‰§è¡ŒåŸç†å’Œç”Ÿå‘½å‘¨æœŸ
- å­¦ä¹ Spring Bootä¸å¾®æœåŠ¡çš„é›†æˆ

---

<!-- ç§»é™¤äº†åº•éƒ¨é‡å¤çš„ 4.3 åˆ‡æ¢å†…ç½®WebæœåŠ¡å™¨ å†…å®¹ï¼ˆå·²åœ¨ 4.2 åå‘ˆç°ï¼‰ -->

<!-- åˆ é™¤é‡å¤çš„4.11ç« èŠ‚ï¼Œå†…å®¹å·²å¹¶å…¥4.2ï¼Œé¿å…é‡å¤é˜…è¯» -->

<!-- ç§»é™¤äº†åº•éƒ¨é‡å¤çš„ 4.6 è‡ªå®šä¹‰ Starter å®ç° å†…å®¹ï¼ˆå·²åœ¨ 4.5 åå‘ˆç°ï¼‰ -->
